<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ingl√™s ‚Äî 5.¬∫ ano ‚Ä¢ Grammar & Vocabulary Trainer</title>
<meta name="description" content="Verb to be, pronomes pessoais, n√∫meros (cardinais/ordinais), dias, meses e escrita: About me ‚Äî com flashcards, testes, V/F e progresso." />
<style>
  :root{
    --bg:#0f172a; --card:#111827; --card-2:#0b1224; --fg:#e5e7eb; --muted:#94a3b8;
    --link:#38bdf8; --border:#1f2937; --ok:#10b981; --bad:#ef4444;
    --btn:#1e293b; --btn-hover:#243447;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f8fafc; --card:#ffffff; --card-2:#f1f5f9; --fg:#0f172a; --muted:#475569; --border:#e2e8f0; --btn:#e2e8f0; --btn-hover:#cbd5e1; }
  }
  *{box-sizing:border-box}
  body{ margin:0; background:var(--bg); color:var(--fg); font:16px/1.45 system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji" }
  header{ position:sticky; top:0; z-index:5; backdrop-filter:saturate(180%) blur(8px);
    background:linear-gradient(to bottom, rgba(2,6,23,.9), rgba(2,6,23,.6)); border-bottom:1px solid var(--border) }
  .wrap{ max-width:1100px; margin:0 auto; padding:1rem }
  h1{ margin:.2rem 0 0; font-size:clamp(1.1rem,2.2vw,1.5rem) }
  .subtitle{ color:var(--muted); font-size:.95rem }
  nav{ margin-top:.7rem; display:flex; gap:.5rem; flex-wrap:wrap }
  nav button{ background:var(--btn); color:var(--fg); border:1px solid var(--border); padding:.5rem .8rem; border-radius:.6rem; cursor:pointer }
  nav button.active{ outline:2px solid var(--link) }
  main{ padding:1rem 0 2rem }
  .grid{ display:grid; grid-template-columns: 1.1fr .9fr; gap:1rem; align-items:start }
  @media (max-width: 1000px){ .grid{ grid-template-columns:1fr } }
  .panel{ background:var(--card); border:1px solid var(--border); border-radius:.9rem; padding:1rem }
  .toolbar{ display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; margin-bottom:.6rem }
  .toolbar select, .toolbar input[type="number"], .toolbar input[type="text"]{ background:var(--card-2); color:var(--fg); border:1px solid var(--border); padding:.45rem .6rem; border-radius:.6rem }
  .btn{ background:var(--btn); color:var(--fg); border:1px solid var(--border); padding:.6rem .9rem; border-radius:.7rem; cursor:pointer; transition:.15s transform }
  .btn:hover{ background:var(--btn-hover); transform: translateY(-1px) }
  .btn.primary{ background:linear-gradient(135deg,#2563eb,#06b6d4); border:none }
  .btn.good{ background:linear-gradient(135deg,#16a34a,#22c55e); border:none }
  .btn.bad{ background:linear-gradient(135deg,#ef4444,#f97316); border:none }
  .muted{ color:var(--muted) } .small{ font-size:.9rem }
  .pill{ display:inline-flex; align-items:center; gap:.35rem; padding:.2rem .5rem; border:1px solid var(--border); border-radius:999px; background:var(--card-2); color:var(--muted); font-size:.8rem }
  .progress{ height:10px; background:var(--card-2); border:1px solid var(--border); border-radius:999px; overflow:hidden }
  .bar{ height:100%; background:linear-gradient(90deg,#06b6d4,#22c55e) }
  .flashcard{ background: radial-gradient(1200px 600px at 50% -200px, rgba(59,130,246,.25), transparent 60%), var(--card);
    border:1px solid var(--border); border-radius:1rem; padding:1.2rem; min-height:210px; display:flex; flex-direction:column; justify-content:space-between }
  .flash-q{ font-size:1.1rem }
  .flash-a{ margin-top:.8rem; padding:.8rem; border-radius:.7rem; border:1px dashed var(--border); background:var(--card-2) }
  .two-col{ display:grid; grid-template-columns:1fr 1fr; gap:.5rem }
  .two-col>.btn{ width:100% }
  .stack{ display:flex; flex-direction:column; gap:.5rem }
  .list{ display:flex; flex-direction:column; gap:.5rem; max-height:420px; overflow:auto }
  .item{ border:1px solid var(--border); border-radius:.6rem; padding:.6rem .7rem; display:flex; justify-content:space-between; align-items:center; gap:.6rem; background:var(--card-2) }
  .foot{ display:flex; flex-wrap:wrap; gap:.5rem; align-items:center; justify-content:space-between; margin-top:1rem; padding-top:1rem; border-top:1px dashed var(--border); color:var(--muted) }
  .score{ font-weight:700 }
  .hidden{ display:none !important }
  .tag{ font-size:.78rem; padding:.15rem .45rem; border-radius:.45rem; border:1px solid var(--border); background:var(--card-2); color:var(--muted) }
  details[open] summary{ margin-bottom:.5rem }
  summary{ cursor:pointer }
  .print-all{ max-height:55vh; overflow:auto; border:1px dashed var(--border); padding:.6rem; border-radius:.6rem; background:var(--card-2) }
  textarea{ width:100%; min-height:160px; background:var(--card-2); color:var(--fg); border:1px solid var(--border); border-radius:.6rem; padding:.6rem }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Ingl√™s ‚Äî 5.¬∫ ano <span class="muted">to be ‚Ä¢ pronomes ‚Ä¢ n√∫meros ‚Ä¢ dias ‚Ä¢ meses ‚Ä¢ escrita</span></h1>
    <div class="subtitle">Flashcards, Testes, V/F e Escrita ‚Ä¢ Progresso local ‚Ä¢ PT‚ÄëPT</div>
    <nav aria-label="Modos">
      <button class="tabbtn active" data-tab="flash">Cart√µes</button>
      <button class="tabbtn" data-tab="quiz">Teste R√°pido</button>
      <button class="tabbtn" data-tab="vf">Verdadeiro/Falso</button>
      <button class="tabbtn" data-tab="write">Escrita (About me)</button>
      <button class="tabbtn" data-tab="painel">Painel</button>
      <button class="tabbtn" data-tab="def">Imprimir Cart√µes</button>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- CART√ïES -->
  <section id="flash" class="grid tab">
    <div class="panel">
      <div class="toolbar">
        <label>Tema:
          <select id="temaSelect"></select>
        </label>
        <span class="pill">Devidos hoje: <strong id="dueCount">0</strong></span>
        <span class="pill">Dom√≠nio: <strong id="masteryPct">0%</strong></span>
        <span class="pill">Sess√£o: <strong id="sessStats">0/0</strong></span>
        <span class="pill">‚è± <span id="timer">00:00</span></span>
        <span class="small muted">Atalhos: <span class="tag">Espa√ßo</span> Revelar ‚Ä¢ <span class="tag">A</span> Acertei ‚Ä¢ <span class="tag">E</span> Errei</span>
      </div>

      <div class="flashcard" aria-live="polite">
        <div>
          <div class="small muted" id="fcMeta"></div>
          <div class="flash-q" id="fcQ">Carregar em ‚ÄúNovo cart√£o‚Äù.</div>
          <div class="flash-a hidden" id="fcA"></div>
        </div>
        <div class="two-col">
          <button id="revealBtn" class="btn primary"><strong>Revelar</strong></button>
          <button id="nextBtn" class="btn">Novo cart√£o</button>
        </div>
        <div class="two-col">
          <button id="wrongBtn" class="btn bad" disabled><strong>Errei</strong></button>
          <button id="rightBtn" class="btn good" disabled><strong>Acertei</strong></button>
        </div>
      </div>
      <div class="foot small">
        <div>Revis√£o espa√ßada: <span class="muted">Leitner (caixas 1‚Üí3: ~1/3/7 dias)</span></div>
        <div class="muted">Progresso guarda em <code>localStorage</code>.</div>
      </div>
    </div>

    <aside class="panel stack">
      <h3 style="margin:0 0 .2rem">Resumo</h3>
      <div class="progress"><div id="globalBar" class="bar" style="width:0%"></div></div>
      <div class="list" id="temaList"></div>

      <details>
        <summary class="muted">Exportar / Importar / Repor</summary>
        <div class="stack">
          <button class="btn" id="exportBtn">Exportar progresso (JSON)</button>
          <input type="file" id="importFile" accept="application/json" />
          <button class="btn bad" id="resetBtn">Repor tudo</button>
        </div>
      </details>
    </aside>
  </section>

  <!-- TESTE R√ÅPIDO -->
  <section id="quiz" class="grid tab hidden">
    <div class="panel">
      <div class="toolbar">
        <label>N¬∫ de perguntas:
          <input type="number" id="quizN" min="5" max="25" value="10" />
        </label>
        <label>Tema:
          <select id="quizTema"></select>
        </label>
        <label>N√≠vel:
          <select id="quizLvl">
            <option value="medio" selected>M√©dio</option>
            <option value="dificil">Dif√≠cil</option>
            <option value="facil">F√°cil</option>
          </select>
        </label>
        <button class="btn primary" id="startQuiz">Come√ßar teste</button>
        <span class="pill">Pontua√ß√£o: <strong id="quizScore">0</strong></span>
      </div>
      <div id="quizBox" class="stack"></div>
      <p class="small muted">Atalhos: <span class="tag">1</span><span class="tag">2</span><span class="tag">3</span><span class="tag">4</span> escolhem op√ß√£o ‚Ä¢ <span class="tag">Enter</span> pr√≥xima.</p>
    </div>
    <aside class="panel">
      <h3 style="margin:0 0 .3rem">Hist√≥rico</h3>
      <div id="quizHistory" class="stack small"></div>
    </aside>
  </section>

  <!-- VERDADEIRO / FALSO -->
  <section id="vf" class="grid tab hidden">
    <div class="panel">
      <div class="toolbar">
        <button class="btn primary" id="vfNew">Nova afirma√ß√£o</button>
        <span class="pill">Corretas na sess√£o: <strong id="vfSess">0</strong></span>
      </div>
      <div class="flashcard">
        <div>
          <div class="small muted" id="vfMeta"></div>
          <div class="flash-q" id="vfText">Clique em ‚ÄúNova afirma√ß√£o‚Äù.</div>
          <div class="flash-a hidden" id="vfExp"></div>
        </div>
        <div class="two-col">
          <button class="btn bad" id="vfF">Falso</button>
          <button class="btn good" id="vfV">Verdadeiro</button>
        </div>
      </div>
      <p class="small muted">Atalhos: <span class="tag">V</span> Verdadeiro ‚Ä¢ <span class="tag">F</span> Falso ‚Ä¢ <span class="tag">Espa√ßo</span> nova afirma√ß√£o.</p>
    </div>
    <aside class="panel">
      <h3 style="margin:0 0 .3rem">Dica</h3>
      <p class="small muted">Repara em mai√∫sculas (dias/meses, ‚ÄúI‚Äù) e nas formas <em>am/is/are</em>.</p>
    </aside>
  </section>

  <!-- ESCRITA -->
  <section id="write" class="grid tab hidden">
    <div class="panel">
      <h3 style="margin-top:0">Escrita ‚Äî ‚ÄúAbout me‚Äù</h3>
      <div class="toolbar" style="gap:.6rem 1rem">
        <input id="wName" type="text" placeholder="Nome (ex.: Jo√£o Silva)" />
        <input id="wAge" type="number" min="1" max="120" placeholder="Idade" style="width:110px" />
        <input id="wCity" type="text" placeholder="Cidade (ex.: Porto)" />
        <input id="wCountry" type="text" placeholder="Pa√≠s (ex.: Portugal)" />
        <input id="wStreet" type="text" placeholder="Rua (podes inventar)" />
        <input id="wNum" type="text" placeholder="N.¬∫ (ex.: 12)" style="width:110px" />
      </div>
      <div class="toolbar">
        <label>Dia da semana:
          <select id="wDay"></select>
        </label>
        <label>M√™s:
          <select id="wMonth"></select>
        </label>
        <label>Dia (n.¬∫):
          <input id="wDayNum" type="number" min="1" max="31" value="1" style="width:110px" />
        </label>
        <button class="btn" id="wGen">Gerar par√°grafo</button>
        <button class="btn" id="wCheck">Verificar escrita</button>
        <button class="btn" id="wFix">Aplicar corre√ß√µes</button>
        <button class="btn" id="wCopy">Copiar</button>
      </div>
      <textarea id="wOut" placeholder="O teu texto aparecer√° aqui..."></textarea>
      <div id="wReport" class="small muted" style="margin-top:.4rem"></div>
      <p class="small muted">A professora M√≥nica indicou que podem <strong>inventar</strong> dados (ex.: nome da rua) ‚Äî o importante √© estar <strong>bem escrito</strong>.</p>
    </div>
    <aside class="panel">
      <h3 style="margin:0 0 .3rem">Modelo (exemplo)</h3>
      <p class="small">My name is <em>Jo√£o Silva</em>. I am <em>11</em> years old. I live in <em>Porto</em>, <em>Portugal</em>. My address is <em>12</em> <em>Flower</em> Street. Today is <em>Monday</em>, <em>March</em> <em>4th</em>. I am a student.</p>
      <p class="small muted">Conselhos: ‚ÄúI‚Äù mai√∫sculo, dias/meses com mai√∫scula, termina cada frase com ponto.</p>
    </aside>
  </section>

  <!-- PAINEL -->
  <section id="painel" class="tab hidden">
    <div class="panel">
      <h3 style="margin-top:0">Painel de Progresso</h3>
      <div class="grid" style="grid-template-columns:.9fr 1.1fr">
        <div class="stack">
          <div class="item"><span>Total de cart√µes</span><strong id="pTotal">0</strong></div>
          <div class="item"><span>Vistos (alguma vez)</span><strong id="pVistos">0</strong></div>
          <div class="item"><span>Dom√≠nio (caixa 3)</span><strong id="pDom">0</strong></div>
          <div class="item"><span>Devidos hoje</span><strong id="pDueToday">0</strong></div>
          <div class="item"><span>Tempo total de estudo</span><strong id="pTime">0 min</strong></div>
          <div class="item"><span>Streak di√°rio (‚â•10 cart√µes)</span><strong id="pStreak">0 üî•</strong></div>
        </div>
        <div class="panel" style="background:var(--card-2)">
          <h4 style="margin-top:0">Revis√µes pr√≥ximas (14 dias)</h4>
          <div id="calendar" class="stack small"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- IMPRIMIR -->
  <section id="def" class="tab hidden">
    <div class="panel">
      <h3 style="margin-top:0">Imprimir / Rever todos os cart√µes</h3>
      <div id="printAll" class="print-all small"></div>
      <button class="btn" onclick="window.print()">Imprimir</button>
    </div>
  </section>
</main>

<footer class="wrap small muted" style="padding-bottom:2rem">
  <div>Treino espec√≠fico: <em>to be</em>, pronomes pessoais, n√∫meros, dias, meses e ‚ÄúAbout me‚Äù. Conte√∫do pensado para 5.¬∫ ano (PT‚ÄëPT). Progresso guardado localmente.</div>
</footer>

<script>
/* =======================================================
   Dados base: gram√°tica e vocabul√°rio
   ======================================================= */
const THEMES = [
  "Gram√°tica ‚Äî To be (afirm.)",
  "Gram√°tica ‚Äî To be (neg.)",
  "Gram√°tica ‚Äî To be (interr.)",
  "Gram√°tica ‚Äî Pronomes pessoais",
  "Vocabul√°rio ‚Äî Dias da semana",
  "Vocabul√°rio ‚Äî Meses",
  "Vocabul√°rio ‚Äî N√∫meros (cardinais)",
  "Vocabul√°rio ‚Äî N√∫meros (ordinais)",
  "Escrita ‚Äî About me"
];
const PRONS = [
  {pt:"eu", en:"I", tobe:{aff:"am", neg:"am not", int:"Am I"}},
  {pt:"tu/voc√™", en:"you", tobe:{aff:"are", neg:"are not", int:"Are you"}},
  {pt:"ele", en:"he", tobe:{aff:"is", neg:"is not", int:"Is he"}},
  {pt:"ela", en:"she", tobe:{aff:"is", neg:"is not", int:"Is she"}},
  {pt:"isto/animal", en:"it", tobe:{aff:"is", neg:"is not", int:"Is it"}},
  {pt:"n√≥s", en:"we", tobe:{aff:"are", neg:"are not", int:"Are we"}},
  {pt:"voc√™s", en:"you", tobe:{aff:"are", neg:"are not", int:"Are you"}},
  {pt:"eles/elas", en:"they", tobe:{aff:"are", neg:"are not", int:"Are they"}}
];
const DAYS = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const CARDINALS = {
  0:"zero",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine",10:"ten",
  11:"eleven",12:"twelve",13:"thirteen",14:"fourteen",15:"fifteen",16:"sixteen",17:"seventeen",18:"eighteen",19:"nineteen",20:"twenty",
  30:"thirty",40:"forty",50:"fifty",60:"sixty",70:"seventy",80:"eighty",90:"ninety",100:"one hundred"
};
function ordinalWord(n){
  const base = {1:"first",2:"second",3:"third",4:"fourth",5:"fifth",6:"sixth",7:"seventh",8:"eighth",9:"ninth",10:"tenth",11:"eleventh",12:"twelfth",13:"thirteenth",14:"fourteenth",15:"fifteenth",16:"sixteenth",17:"seventeenth",18:"eighteenth",19:"nineteenth",20:"twentieth",30:"thirtieth"};
  if(base[n]) return base[n];
  if(n>20 && n<30) return "twenty-" + base[n-20].replace("th","") + "th";
  if(n>30 && n<40) return "thirty-" + base[n-30].replace("th","") + "th";
  if(n>40 && n<50) return "forty-" + base[n-40].replace("th","") + "th";
  if(n>50 && n<60) return "fifty-" + base[n-50].replace("th","") + "th";
  return n+"th"; // fallback
}
function cardinalWord(n){
  if(CARDINALS[n]) return CARDINALS[n];
  if(n<100){
    const tens = Math.floor(n/10)*10, unit = n%10;
    return CARDINALS[tens] + "-" + CARDINALS[unit];
  }
  return ""+n;
}

/* =======================================================
   Cart√µes (flashcards)
   ======================================================= */
let CARDS = [];
let id=1;
function addCard(tema, q, a, curto=true){ CARDS.push({id:id++, tema, q, a, curto}); }
// To be ‚Äî afirmativa
PRONS.forEach(p=>{
  addCard("Gram√°tica ‚Äî To be (afirm.)", `Completa (afirm.): <strong>${p.en}</strong> ___ a student.`, `${p.en} ${p.tobe.aff} a student.`, true);
  if(p.en==="it") addCard("Gram√°tica ‚Äî To be (afirm.)", `Completa: <strong>${p.en}</strong> ___ a big cat.`, `${p.en} ${p.tobe.aff} a big cat.`, true);
});
// To be ‚Äî negativa
PRONS.forEach(p=>{
  const neg = p.tobe.neg;
  addCard("Gram√°tica ‚Äî To be (neg.)", `Completa (neg.): <strong>${p.en}</strong> ___ not at home.`, `${p.en} ${neg} at home.`, true);
});
// To be ‚Äî interrogativa
PRONS.forEach(p=>{
  addCard("Gram√°tica ‚Äî To be (interr.)", `Faz a pergunta: ‚Äú${p.en} ______ from Portugal?‚Äù`, `${p.tobe.int} from Portugal?`, true);
});
// Pronomes pessoais
PRONS.forEach(p=>{
  addCard("Gram√°tica ‚Äî Pronomes pessoais", `Pronome pessoal para ‚Äú${p.pt}‚Äù`, `${p.en}`, true);
});
// Dias, meses
DAYS.forEach((d,i)=> addCard("Vocabul√°rio ‚Äî Dias da semana", `Tradu√ß√£o: <strong>${["segunda","ter√ßa","quarta","quinta","sexta","s√°bado","domingo"][i]}‚Äëfeira</strong>`, d, true));
MONTHS.forEach((m,i)=> addCard("Vocabul√°rio ‚Äî Meses", `Tradu√ß√£o: <strong>${["janeiro","fevereiro","mar√ßo","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"][i]}</strong>`, m, true));
// N√∫meros (cardinais)
[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,30,40,50,60,70,80,90,100].forEach(n=>{
  addCard("Vocabul√°rio ‚Äî N√∫meros (cardinais)", `Escreve por extenso (cardinal): <strong>${n}</strong>`, cardinalWord(n), true);
});
// N√∫meros (ordinais)
[1,2,3,4,5,6,7,8,9,10,11,12,13,20,21,22,23,24,30,31].forEach(n=>{
  addCard("Vocabul√°rio ‚Äî N√∫meros (ordinais)", `Escreve por extenso (ordinal): <strong>${n}${["th","st","nd","rd"][n%10>3?0:n%10] || "th"}</strong>`, ordinalWord(n), true);
});
// Escrita ‚Äî About me (dicas)
addCard("Escrita ‚Äî About me", "Qual √© a forma correta de \"I\" (mai√∫scula/min√∫scula)?", "Em ingl√™s, <strong>I</strong> escreve-se sempre com mai√∫scula.", false);
addCard("Escrita ‚Äî About me", "Devem os dias e meses levar mai√∫scula em ingl√™s?", "Sim, dias da semana e meses escrevem‚Äëse com <strong>mai√∫scula</strong>.", false);

/* =======================================================
   V/F ‚Äî Gram√°tica + Vocabul√°rio
   ======================================================= */
const VF = [
  {t:"‚ÄúHe are‚Äù √© correto.", v:false, e:"Com he/she/it usa-se <em>is</em> ‚Üí ‚ÄúHe is‚Äù."},
  {t:"A forma interrogativa com ‚Äúyou‚Äù √© ‚ÄúAre you‚Ä¶?‚Äù", v:true, e:"Para you/we/they, usa-se <em>are</em> na pergunta."},
  {t:"A negativa de ‚Äúshe is‚Äù √© ‚Äúshe aren‚Äôt‚Äù.", v:false, e:"Negativa correta: ‚Äúshe is not / she isn‚Äôt‚Äù."},
  {t:"‚ÄúI'm‚Äù √© a contra√ß√£o de ‚ÄúI am‚Äù.", v:true, e:"Correto: I am ‚Üí I'm."},
  {t:"‚ÄúThey is at school.‚Äù est√° correto.", v:false, e:"Com they usa-se <em>are</em> ‚Üí ‚ÄúThey are at school.‚Äù"},
  {t:"Em ingl√™s, dias e meses escrevem-se com mai√∫scula.", v:true, e:"Ex.: Monday, March."},
  {t:"‚ÄúThree‚Äù √© um n√∫mero cardinal.", v:true, e:"Cardinais: one, two, three‚Ä¶"},
  {t:"O ordinal de 3 √© ‚Äúthird‚Äù.", v:true, e:"1st first, 2nd second, 3rd third."},
  {t:"‚ÄúTwelveth‚Äù √© a grafia correta de 12th.", v:false, e:"Correto: ‚Äútwelfth‚Äù."},
  {t:"‚ÄúIt‚Äù usa-se para objetos/animais.", v:true, e:"E para coisas em geral."},
  {t:"A pergunta correta √© ‚ÄúIs she your sister?‚Äù", v:true, e:"Com she ‚Üí is."},
  {t:"‚ÄúYou am my friend.‚Äù est√° correto.", v:false, e:"Com you ‚Üí are: ‚ÄúYou are my friend.‚Äù"}
];

/* =======================================================
   Banco de perguntas de escolha m√∫ltipla (gerado)
   ======================================================= */
const QBANK = [];
function Q(tema, q, opts, correct, exp){ QBANK.push({tema,q,opts,correct,exp}); }
// to be ‚Äî escolhas
(function buildToBe(){
  const base = [
    {s:"I",   tail:" ___ 11 years old.",  ok:"am"},
    {s:"You", tail:" ___ my friend.",     ok:"are"},
    {s:"He",  tail:" ___ at home.",       ok:"is"},
    {s:"She", tail:" ___ a teacher.",     ok:"is"},
    {s:"It",  tail:" ___ a big cat.",     ok:"is"},
    {s:"We",  tail:" ___ from Portugal.", ok:"are"},
    {s:"You", tail:" ___ in class.",      ok:"are"},
    {s:"They",tail:" ___ happy.",         ok:"are"},
  ];
  base.forEach(b=>{
    const tema = "Gram√°tica ‚Äî To be (afirm.)";
    const q = `${b.s}${b.tail}`;
    const opts = ["am","is","are","be"];
    Q(tema, q, opts, b.ok, `Com <em>${b.s.toLowerCase()}</em>, usa-se ‚Äú${b.ok}‚Äù.`);
  });
  // Negativa
  const neg = [
    {s:"I", ok:"am not"},
    {s:"You", ok:"are not"},
    {s:"He", ok:"is not"},
    {s:"She", ok:"is not"},
    {s:"It", ok:"is not"},
    {s:"We", ok:"are not"},
    {s:"They", ok:"are not"}
  ];
  neg.forEach(n=>{
    const tema = "Gram√°tica ‚Äî To be (neg.)";
    const q = `${n.s} ___ not at home.`;
    const opts = ["am not","is not","are not","aren't"];
    Q(tema, q, opts, n.ok, `Negativa com <em>${n.s.toLowerCase()}</em>: ‚Äú${n.ok}‚Äù.`);
  });
  // Interrogativa (Are/Is/Am)
  const interr = [
    {s:"you", ok:"Are", end:" from Lisbon?"},
    {s:"they", ok:"Are", end:" at school?"},
    {s:"she", ok:"Is", end:" your sister?"},
    {s:"he", ok:"Is", end:" a student?"},
    {s:"it", ok:"Is", end:" a cat?"},
    {s:"we", ok:"Are", end:" ready?"}
  ];
  interr.forEach(i=>{
    const tema = "Gram√°tica ‚Äî To be (interr.)";
    const q = `___ ${i.s} ${i.end}`;
    const opts = ["Am","Is","Are","Do"];
    Q(tema, q, opts, i.ok, `Pergunta com <em>${i.s}</em> usa ‚Äú${i.ok}‚Äù.`);
  });
  // Pronomes
  const pron = [
    {pt:"ela", en:"she"}, {pt:"ele", en:"he"}, {pt:"n√≥s", en:"we"},
    {pt:"eu", en:"I"}, {pt:"voc√™s", en:"you"}, {pt:"isto/animal", en:"it"}
  ];
  pron.forEach(p=>{
    const tema = "Gram√°tica ‚Äî Pronomes pessoais";
    const q = `Pronome pessoal para ‚Äú${p.pt}‚Äù`;
    const opts = ["she","he","it","they","we","I","you"].sort(()=>Math.random()-0.5).slice(0,4);
    if(!opts.includes(p.en)) { opts[0]=p.en; }
    Q(tema, q, opts, p.en, `Em ingl√™s: ${p.pt} ‚Üí <strong>${p.en}</strong>.`);
  });
})();
(function buildVocab(){
  // Dias
  const ptDias = ["segunda","ter√ßa","quarta","quinta","sexta","s√°bado","domingo"];
  DAYS.forEach((d,i)=>{
    const tema = "Vocabul√°rio ‚Äî Dias da semana";
    const q = `Tradu√ß√£o de <strong>${ptDias[i]}‚Äëfeira</strong>`;
    const opts = sample(["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].filter(x=>x!==d), 3);
    opts.push(d);
    Q(tema, q, shuffle(opts), d, `Correto: ${d}.`);
  });
  // Meses
  const ptMeses = ["janeiro","fevereiro","mar√ßo","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];
  MONTHS.forEach((m,i)=>{
    const tema = "Vocabul√°rio ‚Äî Meses";
    const q = `Tradu√ß√£o de <strong>${ptMeses[i]}</strong>`;
    const opts = sample(MONTHS.filter(x=>x!==m), 3); opts.push(m);
    Q(tema, q, shuffle(opts), m, `Correto: ${m}.`);
  });
  // Cardinais (com distratores plaus√≠veis ‚Äî grafias parecidas)
  const tricky = {
    three:["tree","there","free"], four:["for","fourty","fur"],
    eight:["ate","eigth","height"], two:["tow","too","to"],
    eleven:["elve","elevenn","seven"], twelve:["twelv","twelf","twelve"],
    thirteen:["thirty","threeteen","therteen"], fifteen:["fiveteen","fiften","fifty"],
    forty:["fourty","fortey","fourteen"]
  };
  [1,2,3,4,5,6,7,8,9,10,11,12,13,15,20,30,40,50,60].forEach(n=>{
    const w = cardinalWord(n);
    const tema = "Vocabul√°rio ‚Äî N√∫meros (cardinais)";
    const q = `Escreve por extenso <strong>${n}</strong>`;
    const base = tricky[w] || [];
    const opts = unique([w].concat(base).concat(sample(Object.values(CARDINALS), 6))).filter(Boolean).slice(0,4);
    Q(tema, q, shuffle(opts), w, `Forma correta: <strong>${w}</strong>.`);
  });
  // Ordinais
  const ords = [1,2,3,4,5,6,7,8,9,10,11,12,13,20,21,22,23,24,30,31];
  ords.forEach(n=>{
    const w = ordinalWord(n);
    const tema = "Vocabul√°rio ‚Äî N√∫meros (ordinais)";
    const suffix = (n===1)?"1st":(n===2)?"2nd":(n===3)?"3rd":(n+"th");
    const wrong = [w.replace("fth","veth"), w.replace("th","st"), w.replace("t","tt")].filter(x=>x!==w);
    const opts = shuffle(unique([w].concat(wrong, sample(["first","second","third","twelfth","twentieth","thirtieth"],3)))).slice(0,4);
    Q(tema, `Escreve por extenso <strong>${suffix}</strong>`, opts, w, `Correto: <strong>${w}</strong>.`);
  });
  // About me / pessoal
  const tema = "Escrita ‚Äî About me";
  Q(tema, "Escolhe a melhor resposta: <em>Where do you live?</em>", ["I live in Porto.","I lives in Porto.","I am live in Porto.","I living in Porto."], "I live in Porto.", "Presente simples: ‚ÄúI live‚Ä¶‚Äù.");
  Q(tema, "Escolhe a melhor resposta: <em>Where are you from?</em>", ["I am from Lisbon.","I from Lisbon.","I are from Lisbon.","I am at Lisbon."], "I am from Lisbon.", "Com ‚ÄúI‚Äù ‚Üí ‚Äúam‚Äù: ‚ÄúI am from ‚Ä¶‚Äù.");
})();

/* =======================================================
   Utilit√°rios e persist√™ncia
   ======================================================= */
const KEY = "EN5_progress_v1";
const STATS_KEY = "EN5_stats_v1";
const todayStr = () => new Date().toISOString().slice(0,10);
const addDays = (d,n)=>{ const t=new Date(d); t.setDate(t.getDate()+n); return t.toISOString().slice(0,10); };
const clamp = (v,a,b)=> Math.min(b, Math.max(a,v));
const unique = arr => Array.from(new Set(arr));
const sample = (arr, k)=> {
  const a=arr.slice(); const out=[];
  while(a.length && out.length<k){ out.push(a.splice(Math.floor(Math.random()*a.length),1)[0]); }
  return out;
};
const shuffle = arr => arr.slice().sort(()=>Math.random()-0.5);

function loadProgress(){ try{ return JSON.parse(localStorage.getItem(KEY)||"{}"); }catch(e){ return {}; } }
function saveProgress(p){ localStorage.setItem(KEY, JSON.stringify(p)); }
function loadStats(){ try{ return JSON.parse(localStorage.getItem(STATS_KEY)||JSON.stringify({timeSec:0, streak:0, lastDay:null, quiz:[]})); }catch(e){ return {timeSec:0, streak:0, lastDay:null, quiz:[]}; } }
function saveStats(s){ localStorage.setItem(STATS_KEY, JSON.stringify(s)); }
let PROG = loadProgress();
let STATS = loadStats();

/* =======================================================
   UI: temas, listas, impress√£o
   ======================================================= */
const temaSelect = document.getElementById('temaSelect');
const quizTema = document.getElementById('quizTema');
["Todos"].concat(THEMES).forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; temaSelect.appendChild(o); quizTema.appendChild(o.cloneNode(true)); });
const temaList = document.getElementById('temaList');
function buildTemaList(){
  temaList.innerHTML="";
  const byTema = Object.fromEntries(THEMES.map(t=>[t, CARDS.filter(c=>c.tema===t)]));
  Object.entries(byTema).forEach(([t, cards])=>{
    const dom = cards.filter(c=> (PROG[c.id]?.box||0)>=3).length;
    const vistos = cards.filter(c=> PROG[c.id]).length;
    const pct = cards.length? Math.round(dom/cards.length*100) : 0;
    const div = document.createElement('div'); div.className="item";
    div.innerHTML = `<div><div><strong>${t}</strong> <span class="tag">${cards.length} cart√µes</span></div>
      <div class="progress" style="margin-top:.3rem;width:260px"><div class="bar" style="width:${pct}%"></div></div>
      <div class="small muted">${dom} dominados ‚Ä¢ ${vistos} vistos</div></div>
      <button class="btn" data-gotema="${t}">Estudar</button>`;
    temaList.appendChild(div);
  });
  temaList.querySelectorAll('button[data-gotema]').forEach(b=> b.onclick=()=>{ temaSelect.value=b.dataset.gotema; pickNextCard(); switchTab('flash'); });
}
function buildPrintAll(){
  const box = document.getElementById('printAll');
  box.innerHTML = CARDS.map(c=> `<details><summary><strong>${c.tema}</strong> ‚Äî ${c.q}</summary><div class="small">${c.a}</div></details>`).join("");
}
buildTemaList(); buildPrintAll();

/* =======================================================
   Flashcards: l√≥gica Leitner 1/3/7
   ======================================================= */
const dueCountEl = document.getElementById('dueCount');
const masteryPctEl = document.getElementById('masteryPct');
const globalBar = document.getElementById('globalBar');
const sessStatsEl = document.getElementById('sessStats');
let sessRight=0, sessTotal=0; let sessionStart=Date.now();
const timerEl=document.getElementById('timer');
function tickTimer(){ const sec=Math.floor((Date.now()-sessionStart)/1000); timerEl.textContent=new Date(sec*1000).toISOString().substr(14,5); }
setInterval(tickTimer,1000);
function cardState(id){ return PROG[id] || { box:0, seen:0, right:0, wrong:0, next:todayStr(), last:null }; }
function schedule(id, correct){
  const s=cardState(id); s.seen++; s.last=todayStr();
  if(correct){ s.right++; s.box=clamp(s.box+1,1,3); } else { s.wrong++; s.box=1; }
  const interval = s.box===1?1:(s.box===2?3:7);
  s.next = correct? addDays(todayStr(), interval) : todayStr();
  PROG[id]=s; saveProgress(PROG);
  sessTotal++; if(correct) sessRight++;
  updateDashboard();
  // streak (>=10 cart√µes num dia)
  const day=todayStr();
  if(sessTotal>=10){
    if(STATS.lastDay!==day){ STATS.streak=(STATS.lastDay===addDays(day,-1))? (STATS.streak||0)+1 : 1; STATS.lastDay=day; saveStats(STATS); }
  }
}
function dueCards(filterTema){
  const day=todayStr();
  return CARDS.filter(c=>{
    const s=cardState(c.id);
    const temaOK=(filterTema==="Todos" || c.tema===filterTema);
    return temaOK && (!s.seen || s.next<=day);
  });
}
function updateDashboard(){
  const total=CARDS.length;
  const dom=CARDS.filter(c=> (cardState(c.id).box)>=3).length;
  const vistos=CARDS.filter(c=> cardState(c.id).seen>0).length;
  const dueToday=dueCards(temaSelect.value).length;
  const pct=Math.round(dom/total*100);
  masteryPctEl.textContent=pct+"%"; globalBar.style.width=pct+"%"; dueCountEl.textContent=dueToday; sessStatsEl.textContent=`${sessRight}/${sessTotal}`;
  document.getElementById('pTotal').textContent=total;
  document.getElementById('pVistos').textContent=vistos;
  document.getElementById('pDom').textContent=dom;
  document.getElementById('pDueToday').textContent=dueCards("Todos").length;
  const elapsed=Math.floor((Date.now()-sessionStart)/1000); const prev=STATS.timeSec||0;
  document.getElementById('pTime').textContent=Math.floor((prev+elapsed)/60)+" min";
  document.getElementById('pStreak').textContent=(STATS.streak||0)+" üî•";
  // calend√°rio (14 dias)
  const cal=document.getElementById('calendar'); const counts={};
  CARDS.forEach(c=>{ const s=cardState(c.id); counts[s.next]=(counts[s.next]||0)+1; });
  cal.innerHTML=""; for(let i=0;i<14;i++){ const d=addDays(todayStr(),i); const n=counts[d]||0; const barw=Math.min(100, n*4);
    const div=document.createElement('div'); div.className="item";
    div.innerHTML=`<span>${d}</span><div class="progress" style="width:200px"><div class="bar" style="width:${barw}%"></div></div><strong>${n}</strong>`;
    cal.appendChild(div);
  }
}
updateDashboard();
// UI flashcards
const fcQ=document.getElementById('fcQ');
const fcA=document.getElementById('fcA');
const fcMeta=document.getElementById('fcMeta');
if(!fcQ || !fcA || !fcMeta) {
  console.error("Critical elements not found:", {fcQ, fcA, fcMeta});
}
let currentCard=null;
let flashAnswered=false; // Track if current card has been answered
function renderCard(c){
  if(!c || !c.q || !c.a) return;
  currentCard=c; 
  if(c.q) fcQ.innerHTML=c.q; 
  if(c.a) fcA.innerHTML=c.a; 
  fcA.classList.add('hidden');
  const revealBtn = document.getElementById('revealBtn');
  const rightBtn = document.getElementById('rightBtn');
  const wrongBtn = document.getElementById('wrongBtn');
  if(revealBtn) revealBtn.disabled=false;
  if(rightBtn) rightBtn.disabled=true;
  if(wrongBtn) wrongBtn.disabled=true;
  flashAnswered=false; // Reset answered flag
  const s=cardState(c.id);
  if(fcMeta) fcMeta.innerHTML=`<span class="tag">${c.tema}</span> <span class="tag">Caixa ${Math.max(1,s.box||1)}</span> <span class="tag">Vistos: ${s.seen||0}</span>`;
}
function pickNextCard(){
  console.log("pickNextCard called, CARDS length:", CARDS.length);
  const filterTema=temaSelect.value;
  const pool=dueCards(filterTema);
  console.log("Pool length:", pool.length, "filterTema:", filterTema);
  if(pool.length>0){ 
    const card = pool[Math.floor(Math.random()*pool.length)];
    console.log("Rendering card from pool:", card);
    renderCard(card); 
    return; 
  }
  const alt=CARDS.filter(c=> (filterTema==="Todos" || c.tema===filterTema))
                 .sort((a,b)=> (cardState(a.id).box||0)-(cardState(b.id).box||0));
  console.log("Alt length:", alt.length);
  if(alt.length>0) {
    console.log("Rendering alt card:", alt[0]);
    renderCard(alt[0]);
  } else {
    console.log("No cards available to render!");
  }
}
document.getElementById('revealBtn').onclick=()=>{ fcA.classList.remove('hidden'); document.getElementById('rightBtn').disabled=false; document.getElementById('wrongBtn').disabled=false; document.getElementById('revealBtn').disabled=true; };
document.getElementById('rightBtn').onclick=()=>{ if(!currentCard || flashAnswered) return; flashAnswered=true; schedule(currentCard.id,true); pickNextCard(); };
document.getElementById('wrongBtn').onclick=()=>{ if(!currentCard || flashAnswered) return; flashAnswered=true; schedule(currentCard.id,false); pickNextCard(); };
document.getElementById('nextBtn').onclick=pickNextCard;
temaSelect.onchange=()=>{ updateDashboard(); pickNextCard(); };
// Atalhos de teclado globais
window.addEventListener('keydown', (e) => {
  if (currentTab === "flash") {
    if (e.code === "Space") { e.preventDefault(); document.getElementById('revealBtn').click(); }
    if (e.key.toLowerCase() === 'a' && !flashAnswered) { document.getElementById('rightBtn').click(); }
    if (e.key.toLowerCase() === 'e' && !flashAnswered) { document.getElementById('wrongBtn').click(); }
  } else if (currentTab === "vf") {
    const key = e.key.toLowerCase();
    if (key === "v" && !vfAnswered) { document.getElementById("vfV").click(); }
    else if (key === "f" && !vfAnswered) { document.getElementById("vfF").click(); }
    else if (e.code === "Space") { e.preventDefault(); document.getElementById("vfNew").click(); }
  }
});

/* Exportar / importar / repor */
document.getElementById('exportBtn').onclick=()=>{
  const payload={progress:PROG, stats:STATS, exportedAt:new Date().toISOString()};
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download="progresso_ingles5.json"; a.click(); URL.revokeObjectURL(url);
};
document.getElementById('importFile').onchange=(ev)=>{
  const file=ev.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    try{
      const data=JSON.parse(reader.result);
      if(data.progress){ PROG=data.progress; saveProgress(PROG); }
      if(data.stats){ STATS=data.stats; saveStats(STATS); }
      alert("Importa√ß√£o conclu√≠da!");
      updateDashboard(); buildTemaList(); pickNextCard();
    }catch(e){ alert("Ficheiro inv√°lido."); }
  };
  reader.readAsText(file);
};
document.getElementById('resetBtn').onclick=()=>{
  if(confirm("Apagar TODO o progresso?")){ localStorage.removeItem(KEY); localStorage.removeItem(STATS_KEY);
    PROG={}; STATS={timeSec:0,streak:0,lastDay:null,quiz:[]}; updateDashboard(); buildTemaList(); alert("Progresso reposto."); }
};

/* =======================================================
   Teste R√°pido ‚Äî distratores plaus√≠veis e n√≠veis
   ======================================================= */
const quizBox=document.getElementById('quizBox');
const startQuizBtn=document.getElementById('startQuiz');
const quizScoreEl=document.getElementById('quizScore');
const quizHistory=document.getElementById('quizHistory');
const quizLvlSel=document.getElementById('quizLvl');
function renderQuizHistory(){
  quizHistory.innerHTML="";
  (STATS.quiz||[]).forEach(r=>{
    const d=new Date(r.date).toLocaleString();
    const row=document.createElement('div'); row.className="item";
    row.innerHTML=`<span>${d} ‚Ä¢ <span class="muted">${r.tema}</span></span> <strong>${r.score}/${r.n} (${r.acc}%)</strong>`;
    quizHistory.appendChild(row);
  });
}
renderQuizHistory();

function buildQuiz(n, tema, level){
  const pool = QBANK.filter(q=> tema==="Todos" ? true : q.tema===tema);
  const chosen = sample(pool, Math.min(n, pool.length));
  let score=0, index=0; quizBox.innerHTML="";

  function renderQ(){
    const q=chosen[index];
    // Ajuste do n√≠vel: em dif√≠cil, escolher op√ß√µes mais pr√≥ximas (sem varia√ß√µes √≥bvias)
    let opts = q.opts.slice();
    if(level==="dificil"){
      // heur√≠stica: ordena por tamanho pr√≥ximo do correto
      const targetLen = q.correct.length;
      opts = opts.sort((a,b)=> Math.abs(a.length-targetLen)-Math.abs(b.length-targetLen));
    }
    opts = shuffle(opts).slice(0,4);
    if(!opts.includes(q.correct)){ opts[Math.floor(Math.random()*opts.length)] = q.correct; }
    const div=document.createElement('div'); div.className="panel"; div.style.marginBottom=".8rem";
    div.innerHTML = `<div class="small muted"><span class="tag">${q.tema}</span> Pergunta ${index+1} de ${chosen.length}</div>
                     <div style="font-size:1.05rem;margin:.4rem 0 .6rem">${q.q}</div>`;
    const exp = document.createElement('div'); exp.className="small muted"; exp.style.marginTop=".4rem";
    const btns=[];
    opts.forEach((txt, i)=>{
      const b=document.createElement('button'); b.className="btn"; b.style.display="block"; b.style.width="100%"; b.style.textAlign="left"; b.style.marginBottom=".4rem";
      b.textContent=txt;
      b.onclick=()=>{
        btns.forEach(x=>x.disabled=true);
        const ok = (txt===q.correct);
        if(ok){ b.classList.add('good'); score++; exp.innerHTML="‚úÖ Correto ‚Äî " + q.correct; }
        else{ b.classList.add('bad'); exp.innerHTML="‚ùå Incorrecto ‚Äî Resposta certa: " + q.correct + (q.exp? " ‚Äî " + q.exp : ""); }
        quizScoreEl.textContent=score;
        div.appendChild(exp);
        if(index<chosen.length-1){
          setTimeout(()=>{ index++; renderQ(); }, 600);
        } else {
          const acc=Math.round(score/chosen.length*100);
          const res=document.createElement('div'); res.className="item"; res.innerHTML=`<span>Resultado final</span> <strong>${score}/${chosen.length} (${acc}%)</strong>`;
          quizBox.appendChild(res);
          STATS.quiz=STATS.quiz||[]; STATS.quiz.unshift({date:new Date().toISOString(), tema, n:chosen.length, score, acc}); STATS.quiz=STATS.quiz.slice(0,10); saveStats(STATS); renderQuizHistory();
        }
      };
      btns.push(b); div.appendChild(b);
    });
    quizBox.appendChild(div);
  }
  renderQ();
}

startQuizBtn.onclick=()=>{
  const n=clamp(parseInt(document.getElementById('quizN').value||"10",10),5,25);
  const tema=document.getElementById('quizTema').value;
  const level=quizLvlSel.value;
  quizScoreEl.textContent="0";
  buildQuiz(n, tema, level);
};

/* =======================================================
   Verdadeiro/Falso (V/F) + atalhos V, F, Espa√ßo
   ======================================================= */
let vfSess=0; const vfSessEl=document.getElementById('vfSess');
let vfAnswered=false; // Track if current question has been answered
function newVF(){
  const i=Math.floor(Math.random()*VF.length); const v=VF[i];
  document.getElementById('vfText').textContent=v.t; document.getElementById('vfText').dataset.idx=i;
  document.getElementById('vfExp').classList.add('hidden'); document.getElementById('vfMeta').textContent="Marque a op√ß√£o correta e veja a explica√ß√£o.";
  vfAnswered=false; // Reset answered flag
  document.getElementById('vfV').disabled=false; // Re-enable buttons
  document.getElementById('vfF').disabled=false;
}
document.getElementById('vfNew').onclick=newVF;
function answerVF(ans){
  if(vfAnswered) return; // Prevent multiple answers
  const idx=+document.getElementById('vfText').dataset.idx; if(isNaN(idx)) return; const v=VF[idx];
  const ok=(ans===v.v); const exp=document.getElementById('vfExp');
  exp.innerHTML=(ok?"‚úÖ Correto. ":"‚ùå Incorrecto. ")+(v.e||""); exp.classList.remove('hidden'); 
  if(ok){ vfSess++; vfSessEl.textContent=vfSess; }
  vfAnswered=true; // Mark as answered
  document.getElementById('vfV').disabled=true; // Disable buttons
  document.getElementById('vfF').disabled=true;
}
document.getElementById('vfV').onclick=()=>answerVF(true);
document.getElementById('vfF').onclick=()=>answerVF(false);

/* =======================================================
   Escrita ‚Äî About me (gera√ß√£o, verifica√ß√£o e corre√ß√£o)
   ======================================================= */
const daySel = document.getElementById('wDay'); DAYS.forEach(d=>{ const o=document.createElement('option'); o.textContent=d; daySel.appendChild(o); });
const monthSel = document.getElementById('wMonth'); MONTHS.forEach(m=>{ const o=document.createElement('option'); o.textContent=m; monthSel.appendChild(o); });
document.getElementById('wGen').onclick=()=>{
  const name = document.getElementById('wName').value.trim()||"Jo√£o Silva";
  const age = document.getElementById('wAge').value.trim()||"11";
  const city = document.getElementById('wCity').value.trim()||"Porto";
  const country = document.getElementById('wCountry').value.trim()||"Portugal";
  const street = document.getElementById('wStreet').value.trim()||"Flower";
  const num = document.getElementById('wNum').value.trim()||"12";
  const day = document.getElementById('wDay').value;
  const month = document.getElementById('wMonth').value;
  const dnum = parseInt(document.getElementById('wDayNum').value||"1",10);
  const ord = ordinalWord(dnum);
  const out = `My name is ${name}. I am ${age} years old. I live in ${city}, ${country}. My address is ${num} ${street} Street. Today is ${day}, ${month} ${ord}. I am a student.`;
  document.getElementById('wOut').value = out;
  document.getElementById('wReport').textContent = "Texto gerado. Clica em ‚ÄúVerificar escrita‚Äù para analisar.";
};
function checkWriting(t){
  const issues=[];
  // ‚Äú i ‚Äù min√∫sculo isolado
  if(/\bi\b/.test(t)) issues.push("A letra ‚ÄúI‚Äù deve estar em mai√∫scula quando √© pronome.");
  // dias/meses min√∫sculos
  DAYS.forEach(d=>{ if(new RegExp("\\b"+d.toLowerCase()+"\\b").test(t.toLowerCase()) && !new RegExp("\\b"+d+"\\b").test(t)) issues.push(`Dia da semana ‚Äú${d}‚Äù deve estar com mai√∫scula.`); });
  MONTHS.forEach(m=>{ if(new RegExp("\\b"+m.toLowerCase()+"\\b").test(t.toLowerCase()) && !new RegExp("\\b"+m+"\\b").test(t)) issues.push(`M√™s ‚Äú${m}‚Äù deve estar com mai√∫scula.`); });
  // combina√ß√µes erradas comuns de to be
  const badPairs = [/you is/gi,/we is/gi,/they is/gi,/i are/gi,/she are/gi,/he are/gi,/it are/gi];
  badPairs.forEach(r=>{ if(r.test(t)) issues.push(`Rev√™ o ‚Äúto be‚Äù: parece haver ‚Äú${r.source.replace(/\\b/g,"")}‚Äù no texto.`); });
  // pontua√ß√£o final nas frases
  const sentences = t.split(/(?<=[\.\!\?])\s+/).filter(x=>x.trim().length>0);
  if(sentences.length && !/[.!?]\s*$/.test(t.trim())) issues.push("Termina a √∫ltima frase com ponto final.");
  return issues;
}
document.getElementById('wCheck').onclick=()=>{
  const t=document.getElementById('wOut').value;
  const issues=checkWriting(t);
  document.getElementById('wReport').innerHTML = (issues.length? "‚ö†Ô∏è <strong>Sugest√µes:</strong><ul><li>"+issues.join("</li><li>")+"</li></ul>" : "‚úÖ Sem problemas detetados.");
};
document.getElementById('wFix').onclick=()=>{
  let t=document.getElementById('wOut').value;
  // Corrigir ‚Äú i ‚Äù isolado
  t = t.replace(/\bi\b/g, "I");
  // Capitalizar dias/meses
  DAYS.forEach(d=>{ t = t.replace(new RegExp("\\b"+d.toLowerCase()+"\\b","g"), d); });
  MONTHS.forEach(m=>{ t = t.replace(new RegExp("\\b"+m.toLowerCase()+"\\b","g"), m); });
  // Corrigir pares comuns (heur√≠stica simples)
  t = t.replace(/\b(you|we|they)\s+is\b/gi, (m,g)=> (g.charAt(0).toUpperCase()+g.slice(1))+" are");
  t = t.replace(/\b(i)\s+are\b/gi, "I am");
  t = t.replace(/\b(she|he|it)\s+are\b/gi, (m,g)=> g.charAt(0).toUpperCase()+g.slice(1)+" is");
  document.getElementById('wOut').value=t;
  document.getElementById('wReport').textContent="Foram aplicadas corre√ß√µes autom√°ticas (b√°sicas). Rev√™ o resultado.";
};
document.getElementById('wCopy').onclick=()=>{
  const ta=document.getElementById('wOut'); ta.select(); document.execCommand('copy');
  document.getElementById('wReport').textContent="Texto copiado para a √°rea de transfer√™ncia.";
};

/* =======================================================
   Tabs + inicializa√ß√£o
   ======================================================= */
let currentTab="flash";
function switchTab(id){
  document.querySelectorAll('.tab').forEach(el=>el.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.querySelectorAll('.tabbtn').forEach(b=> b.classList.toggle('active', b.dataset.tab===id));
  currentTab=id;
  if(id==="flash"){ pickNextCard(); }
  if(id==="painel"){ updateDashboard(); }
}
document.querySelectorAll('.tabbtn').forEach(b=> b.onclick=()=> switchTab(b.dataset.tab));
switchTab("flash");

console.log("Initialization complete. CARDS:", CARDS.length, "Current tab:", currentTab);

/* Guardar tempo ao sair */
window.addEventListener('beforeunload', ()=>{
  const elapsed=Math.floor((Date.now()-sessionStart)/1000);
  STATS.timeSec=(STATS.timeSec||0)+elapsed; saveStats(STATS);
});

/* Pequenas ajudas de acessibilidade: foco no bot√£o ap√≥s trocar de tab */
document.addEventListener('visibilitychange', ()=>{ if(currentTab==="flash") document.getElementById('revealBtn').focus(); });
</script>
</body>
</html>
