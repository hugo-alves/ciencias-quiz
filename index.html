<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ci√™ncias 5.¬∫ ‚Äî Unidade 1 (Estrita v2)</title>
<meta name="description" content="Flashcards + Teste com distratores plaus√≠veis ‚Äî A Terra, planeta especial (PT‚ÄëPT)" />
<style>
  :root{
    --bg:#0f172a; --card:#111827; --card-2:#0b1224; --fg:#e5e7eb; --muted:#94a3b8;
    --accent:#22c55e; --warn:#f59e0b; --danger:#ef4444; --link:#38bdf8; --border:#1f2937;
    --ok:#10b981; --bad:#ef4444; --btn:#1e293b; --btn-hover:#243447;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f8fafc; --card:#ffffff; --card-2:#f1f5f9; --fg:#0f172a; --muted:#475569; --border:#e2e8f0; --btn:#e2e8f0; --btn-hover:#cbd5e1; }
  }
  *{box-sizing:border-box}
  body{ margin:0; background:var(--bg); color:var(--fg); font:16px/1.45 system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji" }
  header{ position:sticky; top:0; z-index:5; backdrop-filter:saturate(180%) blur(8px);
    background:linear-gradient(to bottom, rgba(2,6,23,.9), rgba(2,6,23,.6)); border-bottom:1px solid var(--border) }
  .wrap{ max-width:1100px; margin:0 auto; padding:1rem }
  h1{ margin:.2rem 0 0; font-size:clamp(1.1rem,2.2vw,1.5rem) }
  .subtitle{ color:var(--muted); font-size:.95rem }
  nav{ margin-top:.7rem; display:flex; gap:.5rem; flex-wrap:wrap }
  nav button{ background:var(--btn); color:var(--fg); border:1px solid var(--border); padding:.5rem .8rem; border-radius:.6rem; cursor:pointer }
  nav button.active{ outline:2px solid var(--link) }
  main{ padding:1rem 0 2rem }
  .grid{ display:grid; grid-template-columns: 1.1fr .9fr; gap:1rem; align-items:start }
  @media (max-width: 1000px){ .grid{ grid-template-columns:1fr } }
  .panel{ background:var(--card); border:1px solid var(--border); border-radius:.9rem; padding:1rem }
  .toolbar{ display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; margin-bottom:.6rem }
  .toolbar select, .toolbar input[type="number"]{ background:var(--card-2); color:var(--fg); border:1px solid var(--border); padding:.45rem .6rem; border-radius:.6rem }
  .btn{ background:var(--btn); color:var(--fg); border:1px solid var(--border); padding:.6rem .9rem; border-radius:.7rem; cursor:pointer; transition:.15s transform }
  .btn:hover{ background:var(--btn-hover); transform: translateY(-1px) }
  .btn.primary{ background:linear-gradient(135deg,#2563eb,#06b6d4); border:none }
  .btn.good{ background:linear-gradient(135deg,#16a34a,#22c55e); border:none }
  .btn.bad{ background:linear-gradient(135deg,#ef4444,#f97316); border:none }
  .btn.warn{ background:linear-gradient(135deg,#f59e0b,#f97316); border:none }
  .muted{ color:var(--muted) } .small{ font-size:.9rem }
  .pill{ display:inline-flex; align-items:center; gap:.35rem; padding:.2rem .5rem; border:1px solid var(--border); border-radius:999px; background:var(--card-2); color:var(--muted); font-size:.8rem }
  .progress{ height:10px; background:var(--card-2); border:1px solid var(--border); border-radius:999px; overflow:hidden }
  .bar{ height:100%; background:linear-gradient(90deg,#06b6d4,#22c55e) }
  .flashcard{ background: radial-gradient(1200px 600px at 50% -200px, rgba(59,130,246,.25), transparent 60%), var(--card);
    border:1px solid var(--border); border-radius:1rem; padding:1.2rem; min-height:210px; display:flex; flex-direction:column; justify-content:space-between }
  .flash-q{ font-size:1.1rem }
  .flash-a{ margin-top:.8rem; padding:.8rem; border-radius:.7rem; border:1px dashed var(--border); background:var(--card-2) }
  .two-col{ display:grid; grid-template-columns:1fr 1fr; gap:.5rem }
  .two-col>.btn{ width:100% }
  .stack{ display:flex; flex-direction:column; gap:.5rem }
  .list{ display:flex; flex-direction:column; gap:.5rem; max-height:420px; overflow:auto }
  .item{ border:1px solid var(--border); border-radius:.6rem; padding:.6rem .7rem; display:flex; justify-content:space-between; align-items:center; gap:.6rem; background:var(--card-2) }
  .foot{ display:flex; flex-wrap:wrap; gap:.5rem; align-items:center; justify-content:space-between; margin-top:1rem; padding-top:1rem; border-top:1px dashed var(--border); color:var(--muted) }
  .score{ font-weight:700 }
  .hidden{ display:none !important }
  .tag{ font-size:.78rem; padding:.15rem .45rem; border-radius:.45rem; border:1px solid var(--border); background:var(--card-2); color:var(--muted) }
  details[open] summary{ margin-bottom:.5rem }
  summary{ cursor:pointer }
  .print-all{ max-height:55vh; overflow:auto; border:1px dashed var(--border); padding:.6rem; border-radius:.6rem; background:var(--card-2) }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Ci√™ncias Naturais 5.¬∫ ‚Äî Unidade 1 <span class="muted">A Terra, planeta especial</span></h1>
    <div class="subtitle">VERS√ÉO ESTRITA v2 ‚Äî distratores plaus√≠veis ‚Ä¢ progresso local ‚Ä¢ <span class="muted" title="Baseado exclusivamente nos documentos do projeto">Fonte confirmada</span></div>
    <nav aria-label="Modos">
      <button class="tabbtn active" data-tab="flash">Cart√µes</button>
      <button class="tabbtn" data-tab="quiz">Teste R√°pido</button>
      <button class="tabbtn" data-tab="vf">Verdadeiro/Falso</button>
      <button class="tabbtn" data-tab="painel">Painel</button>
      <button class="tabbtn" data-tab="def">Imprimir Cart√µes</button>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- CART√ïES -->
  <section id="flash" class="grid tab">
    <div class="panel">
      <div class="toolbar">
        <label> Tema:
          <select id="temaSelect"></select>
        </label>
        <span class="pill" id="duePill">Devidos hoje: <strong id="dueCount">0</strong></span>
        <span class="pill">Dom√≠nio: <strong id="masteryPct">0%</strong></span>
        <span class="pill">Sess√£o: <strong id="sessStats">0/0</strong></span>
        <span class="pill">‚è± <span id="timer">00:00</span></span>
        <span class="small muted">Atalhos: <span class="tag">Espa√ßo</span> Revelar ‚Ä¢ <span class="tag">A</span> Acertei ‚Ä¢ <span class="tag">E</span> Errei</span>
      </div>

      <div class="flashcard" aria-live="polite">
        <div>
          <div class="small muted" id="fcMeta"></div>
          <div class="flash-q" id="fcQ">Carregar em ‚ÄúNovo cart√£o‚Äù.</div>
          <div class="flash-a hidden" id="fcA"></div>
        </div>
        <div class="two-col">
          <button id="revealBtn" class="btn primary"><strong>Revelar</strong></button>
          <button id="nextBtn" class="btn">Novo cart√£o</button>
        </div>
        <div class="two-col">
          <button id="wrongBtn" class="btn bad" disabled><strong>Errei</strong></button>
          <button id="rightBtn" class="btn good" disabled><strong>Acertei</strong></button>
        </div>
      </div>
      <div class="foot small">
        <div>Revis√£o espa√ßada: <span class="muted">Leitner (caixas 1‚Üí3: ~1/3/7 dias)</span></div>
        <div class="muted">Progresso guarda em <code>localStorage</code>.</div>
      </div>
    </div>

    <aside class="panel stack">
      <h3 style="margin:0 0 .2rem">Resumo</h3>
      <div class="progress"><div id="globalBar" class="bar" style="width:0%"></div></div>
      <div class="list" id="temaList"></div>

      <details>
        <summary class="muted">Exportar / Importar / Repor</summary>
        <div class="stack">
          <button class="btn" id="exportBtn">Exportar progresso (JSON)</button>
          <input type="file" id="importFile" accept="application/json" />
          <button class="btn warn" id="resetBtn">Repor tudo</button>
        </div>
      </details>
      <p class="small muted">Conte√∫do estritamente alinhado com o documento do projeto.</p>
    </aside>
  </section>

  <!-- TESTE R√ÅPIDO -->
  <section id="quiz" class="grid tab hidden">
    <div class="panel">
      <div class="toolbar">
        <label> N¬∫ de perguntas:
          <input type="number" id="quizN" min="5" max="25" value="10" />
        </label>
        <label> Tema:
          <select id="quizTema"></select>
        </label>
        <label> N√≠vel:
          <select id="quizLvl">
            <option value="medio" selected>M√©dio</option>
            <option value="dificil">Dif√≠cil</option>
            <option value="facil">F√°cil</option>
          </select>
        </label>
        <button class="btn primary" id="startQuiz">Come√ßar teste</button>
        <span class="pill">Pontua√ß√£o: <strong id="quizScore">0</strong></span>
        <span class="small muted">Clique nas op√ß√µes para responder</span>
      </div>
      <div id="quizBox" class="stack"></div>
    </div>
    <aside class="panel">
      <h3 style="margin:0 0 .3rem">Hist√≥rico</h3>
      <div id="quizHistory" class="stack small"></div>
    </aside>
  </section>

  <!-- VERDADEIRO / FALSO -->
  <section id="vf" class="grid tab hidden">
    <div class="panel">
      <div class="toolbar">
        <button class="btn primary" id="vfNew">Nova afirma√ß√£o</button>
        <span class="pill">Corretas na sess√£o: <strong id="vfSess">0</strong></span>
        <span class="small muted">Atalhos: <span class="tag">V</span> Verdadeiro ‚Ä¢ <span class="tag">F</span> Falso ‚Ä¢ <span class="tag">Espa√ßo</span> Nova</span>
      </div>
      <div class="flashcard">
        <div>
          <div class="small muted" id="vfMeta"></div>
          <div class="flash-q" id="vfText">Clique em ‚ÄúNova afirma√ß√£o‚Äù.</div>
          <div class="flash-a hidden" id="vfExp"></div>
        </div>
        <div class="two-col">
          <button class="btn bad" id="vfF">Falso</button>
          <button class="btn good" id="vfV">Verdadeiro</button>
        </div>
      </div>
    </div>
    <aside class="panel">
      <h3 style="margin:0 0 .3rem">Dica</h3>
      <p class="muted small">As op√ß√µes foram escritas para ‚Äúenganar‚Äù de forma justa. L√™ com aten√ß√£o palavras‚Äëchave e compara com os cart√µes.</p>
    </aside>
  </section>

  <!-- PAINEL -->
  <section id="painel" class="tab hidden">
    <div class="panel">
      <h3 style="margin-top:0">Painel de Progresso</h3>
      <div class="grid" style="grid-template-columns: .9fr 1.1fr">
        <div class="stack">
          <div class="item"><span>Total de cart√µes</span><strong id="pTotal">0</strong></div>
          <div class="item"><span>Vistos (alguma vez)</span><strong id="pVistos">0</strong></div>
          <div class="item"><span>Dom√≠nio (caixa 3)</span><strong id="pDom">0</strong></div>
          <div class="item"><span>Devidos hoje</span><strong id="pDueToday">0</strong></div>
          <div class="item"><span>Tempo total de estudo</span><strong id="pTime">0 min</strong></div>
          <div class="item"><span>Streak di√°rio (‚â•10 cart√µes)</span><strong id="pStreak">0 üî•</strong></div>
        </div>
        <div class="panel" style="background:var(--card-2)">
          <h4 style="margin-top:0">Revis√µes pr√≥ximas (14 dias)</h4>
          <div id="calendar" class="stack small"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- IMPRIMIR -->
  <section id="def" class="tab hidden">
    <div class="panel">
      <h3 style="margin-top:0">Imprimir / Rever todos os cart√µes</h3>
      <div id="printAll" class="print-all small"></div>
      <button class="btn" onclick="window.print()">Imprimir</button>
    </div>
  </section>
</main>

<footer class="wrap small muted" style="padding-bottom:2rem">
  <div>Conte√∫do **estrito** retirado do documento do projeto (Unidade 1). Para uso educativo.</div>
</footer>

<script>
/* =======================================================
   DADOS (VERS√ÉO ESTRITA) ‚Äî exclusivamente do documento
   Unidade 1 ‚Äî A Terra, planeta especial
   ======================================================= */
const CARDS = [
  // A Terra
  {id:1, tema:"A Terra", curto:false, q:"Porque √© que a Terra re√∫ne condi√ß√µes para a vida?", a:"Dist√¢ncia ao Sol (temperaturas amenas), √°gua nos tr√™s estados, atmosfera que protege e regula a temperatura, e solo/rochas que suportam a vida."},
  {id:2, tema:"A Terra", curto:true,  q:"Porque √© importante a dist√¢ncia da Terra ao Sol?", a:"Porque permite temperaturas amenas, compat√≠veis com √°gua l√≠quida e com a vida."},
  {id:3, tema:"A Terra", curto:true,  q:"Quais s√£o as quatro esferas estudadas nesta unidade?", a:"Atmosfera, Hidrosfera, Geosfera e Biosfera."},

  // Hidrosfera
  {id:10, tema:"Hidrosfera", curto:false, q:"O que √© a hidrosfera?", a:"Conjunto de todas as √°guas do planeta: oceanos, mares, rios, lagos, aqu√≠feros, gelo e vapor de √°gua."},
  {id:11, tema:"Hidrosfera", curto:true,  q:"Quais s√£o os tr√™s estados f√≠sicos da √°gua?", a:"S√≥lido, l√≠quido e gasoso."},
  {id:12, tema:"Hidrosfera", curto:true,  q:"Define evapora√ß√£o.", a:"Passagem de l√≠quido a gasoso."},
  {id:13, tema:"Hidrosfera", curto:true,  q:"Define condensa√ß√£o.", a:"Passagem de gasoso a l√≠quido."},
  {id:14, tema:"Hidrosfera", curto:true,  q:"Define fus√£o.", a:"Passagem de s√≥lido a l√≠quido."},
  {id:15, tema:"Hidrosfera", curto:true,  q:"Define solidifica√ß√£o.", a:"Passagem de l√≠quido a s√≥lido."},
  {id:16, tema:"Hidrosfera", curto:true,  q:"Define sublima√ß√£o.", a:"Passagem direta de s√≥lido a gasoso."},
  {id:17, tema:"Hidrosfera", curto:false, q:"O que √© o ciclo da √°gua? Indica as etapas.", a:"Circula√ß√£o da √°gua na Natureza: evapora√ß√£o ‚Üí condensa√ß√£o ‚Üí precipita√ß√£o ‚Üí escoamento e infiltra√ß√£o."},
  {id:18, tema:"Hidrosfera", curto:false, q:"Indica duas import√¢ncias da √°gua para os seres vivos.", a:"A √°gua √© solvente e meio de transporte de subst√¢ncias; regula a temperatura; √© habitat de muitos seres vivos."},

  // √Åguas (salinidade e ambientes de transi√ß√£o)
  {id:20, tema:"√Åguas", curto:false, q:"O que √© √°gua doce? D√° exemplos.", a:"√Ågua com baixa salinidade. Exemplos: rios, ribeiras e lagos."},
  {id:21, tema:"√Åguas", curto:false, q:"O que √© √°gua salgada? Onde ocorre?", a:"√Ågua com elevada salinidade. Ocorre em mares e oceanos."},
  {id:22, tema:"√Åguas", curto:false, q:"O que √© √°gua salobra? Onde √© t√≠pica?", a:"Mistura de √°gua doce e salgada, t√≠pica de estu√°rios e sapais."},
  {id:23, tema:"√Åguas", curto:true,  q:"O que s√£o ambientes de transi√ß√£o? D√° dois exemplos.", a:"Zonas entre o terrestre e o aqu√°tico; exemplos: estu√°rios e sapais."},

  // Atmosfera
  {id:30, tema:"Atmosfera", curto:true,  q:"O que √© a atmosfera?", a:"Camada gasosa que envolve a Terra."},
  {id:31, tema:"Atmosfera", curto:false, q:"Qual √© a composi√ß√£o aproximada do ar?", a:"Azoto ~78%, oxig√©nio ~21% e outros gases (CO‚ÇÇ, vapor de √°gua, gases raros)."},
  {id:32, tema:"Atmosfera", curto:false, q:"Indica tr√™s fun√ß√µes da atmosfera.", a:"Permite a respira√ß√£o, protege das radia√ß√µes solares (ozono estratosf√©rico) e regula a temperatura (efeito de estufa natural); possibilita meteorologia (vento, nuvens, precipita√ß√£o)."},
  {id:33, tema:"Atmosfera", curto:true,  q:"Indica duas propriedades do ar.", a:"O ar ocupa espa√ßo, tem massa e exerce press√£o."},

  // Geosfera
  {id:40, tema:"Geosfera", curto:true,  q:"O que √© a geosfera?", a:"Parte s√≥lida da Terra: rochas, minerais e o solo."},
  {id:41, tema:"Geosfera", curto:false, q:"O que s√£o rochas? Refere uma propriedade observ√°vel.", a:"Materiais s√≥lidos da geosfera; propriedades como dureza relativa, cor e granula√ß√£o."},
  {id:42, tema:"Geosfera", curto:false, q:"Como se forma o solo e porque √© importante?", a:"Forma-se pela meteoriza√ß√£o das rochas e pela mat√©ria org√¢nica; √© importante para plantas e muitos seres vivos."},
  {id:43, tema:"Geosfera", curto:true,  q:"Refere uma medida de conserva√ß√£o do solo.", a:"Evitar a eros√£o e usar o solo de forma sustent√°vel."},

  // Biosfera
  {id:50, tema:"Biosfera", curto:false, q:"O que √© a biosfera?", a:"Conjunto de todos os seres vivos e as zonas onde a vida existe."},
  {id:51, tema:"Biosfera", curto:false, q:"Como se relaciona a biosfera com as outras esferas?", a:"Os seres vivos dependem de ar (atmosfera), √°gua (hidrosfera) e rochas/solo (geosfera)."},

  // Ambientes naturais
  {id:60, tema:"Ambientes", curto:true,  q:"D√° exemplos de ambientes terrestres.", a:"Florestas, montanhas, desertos e plan√≠cies."},
  {id:61, tema:"Ambientes", curto:true,  q:"D√° exemplos de ambientes aqu√°ticos.", a:"Rios, lagos, oceanos e lagoas."},
  {id:62, tema:"Ambientes", curto:false, q:"O que caracteriza os ambientes de transi√ß√£o?", a:"Varia√ß√£o de salinidade e influ√™ncia das mar√©s; organismos adaptados (ex.: estu√°rios e sapais)."},
  {id:63, tema:"Ambientes", curto:false, q:"Indica quatro fatores do meio que variam entre ambientes.", a:"Luz, temperatura, √°gua/salinidade e tipo de solo/rocha."},

  // S√≠ntese (Recordo)
  {id:70, tema:"S√≠ntese", curto:true,  q:"Qual √© o √∫nico planeta conhecido com vida?", a:"A Terra (at√© ao momento, a √∫nica com vida confirmada)."},
  {id:71, tema:"S√≠ntese", curto:true,  q:"Em que estados existe a √°gua e como circula?", a:"Existe nos tr√™s estados (s√≥lido, l√≠quido, gasoso) e circula no ciclo da √°gua."},
  {id:72, tema:"S√≠ntese", curto:true,  q:"Porque √© essencial a atmosfera?", a:"Porque protege e permite a vida (respira√ß√£o, regula√ß√£o t√©rmica)."},
  {id:73, tema:"S√≠ntese", curto:true,  q:"O que fornece a geosfera aos ecossistemas terrestres?", a:"Rochas e solo ‚Äî base dos ecossistemas terrestres."}
];

/* =======================================================
   Distratores PONDERADOS (feitos √† m√£o por conceito)
   ‚Äî Todos baseados apenas em termos dos documentos
   ======================================================= */
const DIST = {
  // A Terra
  1: [
    "Porque est√° muito perto do Sol, sem atmosfera e sem necessidade de √°gua.",
    "Porque n√£o precisa de √°gua l√≠quida nem de atmosfera para existir vida.",
    "Porque o solo e as rochas n√£o influenciam a exist√™ncia de vida."
  ],
  2: [
    "Porque impede a precipita√ß√£o e torna os rios sempre de √°gua salgada.",
    "Porque elimina a necessidade de atmosfera protetora.",
    "Porque garante que a Terra n√£o tem varia√ß√µes de temperatura."
  ],
  3: [
    "Vento, √°gua, rochas e seres vivos.",
    "Hidrosfera, Geosfera e Atmosfera (apenas tr√™s esferas).",
    "Ambientes terrestres, aqu√°ticos e de transi√ß√£o."
  ],

  // Hidrosfera
  10: [
    "Parte s√≥lida da Terra: rochas, minerais e o solo.",
    "Camada gasosa que envolve a Terra.",
    "Conjunto de todos os seres vivos e as zonas onde a vida existe."
  ],
  11: [
    "Fus√£o, condensa√ß√£o e evapora√ß√£o.",
    "S√≥lido, l√≠quido e precipita√ß√£o.",
    "Evapora√ß√£o, condensa√ß√£o e precipita√ß√£o."
  ],
  12: [
    "Passagem de gasoso a l√≠quido.",
    "Queda de √°gua sob a forma de precipita√ß√£o.",
    "Passagem de l√≠quido a s√≥lido."
  ],
  13: [
    "Passagem de l√≠quido a gasoso.",
    "Passagem de s√≥lido a l√≠quido.",
    "Queda de √°gua sob a forma de precipita√ß√£o."
  ],
  14: [
    "Passagem de l√≠quido a s√≥lido.",
    "Passagem direta de s√≥lido a gasoso.",
    "Passagem de gasoso a l√≠quido."
  ],
  15: [
    "Passagem de s√≥lido a l√≠quido.",
    "Passagem de l√≠quido a gasoso.",
    "Queda de √°gua sob a forma de precipita√ß√£o."
  ],
  16: [
    "Passagem de gasoso a l√≠quido.",
    "Passagem de l√≠quido a s√≥lido.",
    "Passagem de s√≥lido a l√≠quido."
  ],
  17: [
    "Condensa√ß√£o ‚Üí evapora√ß√£o ‚Üí precipita√ß√£o ‚Üí infiltra√ß√£o.",
    "Precipita√ß√£o ‚Üí infiltra√ß√£o ‚Üí evapora√ß√£o (e termina aqui).",
    "Evapora√ß√£o ‚Üí precipita√ß√£o ‚Üí condensa√ß√£o ‚Üí escoamento."
  ],
  18: [
    "A √°gua n√£o transporta subst√¢ncias nem regula a temperatura.",
    "A √°gua s√≥ √© importante como habitat; n√£o tem outras fun√ß√µes.",
    "A √°gua n√£o √© solvente e n√£o participa no ciclo da √°gua."
  ],

  // √Åguas (salinidade)
  20: [
    "√Ågua com elevada salinidade; mares e oceanos.",
    "Mistura de √°gua doce e salgada; estu√°rios e sapais.",
    "√Ågua sem sais dissolvidos; mar aberto."
  ],
  21: [
    "√Ågua com baixa salinidade; rios, ribeiras e lagos.",
    "Mistura de √°gua doce e salgada; estu√°rios e sapais.",
    "√Ågua sem sal; oceano e mar."
  ],
  22: [
    "√Ågua com baixa salinidade; rios e lagos.",
    "√Ågua com elevada salinidade; mares e oceanos.",
    "√Ågua doce que se transforma em salgada nos rios."
  ],
  23: [
    "Zonas de mar aberto longe da costa.",
    "Zonas secas do deserto sem influ√™ncia de mar√©s.",
    "Zonas apenas terrestres (florestas e montanhas)."
  ],

  // Atmosfera
  30: [
    "Parte s√≥lida da Terra (rochas e solo).",
    "Conjunto de todas as √°guas do planeta.",
    "Conjunto de todos os seres vivos e os seus habitats."
  ],
  31: [
    "Oxig√©nio ~78%, azoto ~21% e outros gases.",
    "Azoto ~70%, oxig√©nio ~29% e outros gases.",
    "Azoto ~80%, oxig√©nio ~19% e outros gases."
  ],
  32: [
    "Aumenta as radia√ß√µes perigosas e impede a respira√ß√£o.",
    "N√£o influencia a temperatura nem a meteorologia.",
    "Serve apenas para formar vento, sem outras fun√ß√µes."
  ],
  33: [
    "O ar n√£o ocupa espa√ßo nem exerce press√£o.",
    "O ar tem apenas temperatura; n√£o tem massa.",
    "O ar s√≥ existe acima das nuvens."
  ],

  // Geosfera
  40: [
    "Camada gasosa que envolve a Terra.",
    "Conjunto de todas as √°guas do planeta.",
    "Conjunto de todos os seres vivos e as zonas onde vivem."
  ],
  41: [
    "Materiais gasosos da atmosfera; propriedades como press√£o e vento.",
    "Materiais l√≠quidos dos mares e rios; propriedades como salinidade.",
    "Materiais vivos da biosfera; propriedades como respira√ß√£o."
  ],
  42: [
    "Forma-se pela solidifica√ß√£o da √°gua do mar; n√£o depende de rochas.",
    "√â produzido diretamente pelas plantas, sem meteoriza√ß√£o.",
    "N√£o resulta da meteoriza√ß√£o; √© apenas areia acumulada."
  ],
  43: [
    "Remover a vegeta√ß√£o para acelerar a eros√£o.",
    "Usar o solo sem limites, pois n√£o se degrada.",
    "Aumentar a eros√£o para renovar rapidamente o solo."
  ],

  // Biosfera
  50: [
    "Camada gasosa que envolve a Terra.",
    "Conjunto de todas as √°guas do planeta.",
    "Parte s√≥lida da Terra (rochas e solo)."
  ],
  51: [
    "Os seres vivos n√£o dependem das outras esferas.",
    "Dependem apenas da atmosfera; n√£o precisam de √°gua nem de solo.",
    "Dependem s√≥ da hidrosfera; o ar e o solo n√£o s√£o necess√°rios."
  ],

  // Ambientes
  60: [
    "Rios, lagos, oceanos e lagoas.",
    "Estu√°rios e sapais.",
    "Mar aberto e zona costeira."
  ],
  61: [
    "Florestas, montanhas, desertos e plan√≠cies.",
    "Plan√≠cies e montanhas.",
    "Estu√°rios e sapais (apenas)."
  ],
  62: [
    "Aus√™ncia de varia√ß√£o de salinidade e de mar√©s.",
    "Zonas apenas terrestres sem influ√™ncia do mar.",
    "Zonas apenas marinhas longe da costa."
  ],
  63: [
    "Vento, nuvens e precipita√ß√£o.",
    "Press√£o do ar, oxig√©nio e di√≥xido de carbono.",
    "Rochas, seres vivos e energia solar."
  ],

  // S√≠ntese
  70: [
    "Existem v√°rios planetas com vida confirmada.",
    "N√£o se sabe se existe vida em qualquer planeta, incluindo a Terra.",
    "A exist√™ncia de vida n√£o depende de √°gua nem de atmosfera."
  ],
  71: [
    "Existe em s√≥lido e l√≠quido; n√£o existe em gasoso.",
    "Circula sem mudan√ßas de estado (sem evapora√ß√£o nem condensa√ß√£o).",
    "S√≥ existe como l√≠quido e move-se apenas nos rios."
  ],
  72: [
    "Porque aumenta as radia√ß√µes perigosas e impede a respira√ß√£o.",
    "Porque n√£o influencia a temperatura do planeta.",
    "Porque apenas permite vento; n√£o tem outras fun√ß√µes."
  ],
  73: [
    "√Ågua doce e salgada ‚Äî base dos ecossistemas.",
    "Ar atmosf√©rico ‚Äî √∫nico suporte dos ecossistemas terrestres.",
    "Solo n√£o tem import√¢ncia para as plantas."
  ]
};

/* =======================================================
   Afirma√ß√µes V/F ‚Äî iguais √† vers√£o estrita
   ======================================================= */
const VF = [
  {t:"A hidrosfera inclui apenas oceanos.", v:false, e:"Inclui oceanos/mares, mas tamb√©m rios, lagos, gelo e vapor de √°gua."},
  {t:"A √°gua salobra ocorre tipicamente em estu√°rios e sapais.", v:true, e:"S√£o ambientes de transi√ß√£o."},
  {t:"A atmosfera √© composta maioritariamente por oxig√©nio (~78%).", v:false, e:"O g√°s mais abundante √© o azoto (~78%); oxig√©nio ~21%."},
  {t:"O ar tem massa e pode exercer press√£o.", v:true, e:"Propriedades do ar."},
  {t:"O ciclo da √°gua inclui evapora√ß√£o, condensa√ß√£o e precipita√ß√£o.", v:true, e:"Com escoamento e infiltra√ß√£o."},
  {t:"A geosfera √© a parte gasosa da Terra.", v:false, e:"√â a parte s√≥lida."},
  {t:"Rios e lagos t√™m √°gua doce (baixa salinidade).", v:true, e:"√Ågua doce: rios, ribeiras e lagos."},
  {t:"O ozono estratosf√©rico ajuda a proteger das radia√ß√µes solares perigosas.", v:true, e:"Fun√ß√£o da atmosfera."},
  {t:"O solo forma-se por meteoriza√ß√£o das rochas e mat√©ria org√¢nica.", v:true, e:"Descrito no documento."},
  {t:"Estu√°rio √© o encontro do rio com o mar.", v:true, e:"Defini√ß√£o indicada no gloss√°rio."},
  {t:"Sapal √© uma zona alagada costeira com vegeta√ß√£o adaptada.", v:true, e:"Defini√ß√£o do gloss√°rio."},
  {t:"√Ågua doce tem elevada salinidade.", v:false, e:"√â baixa salinidade."},
  {t:"Os seres vivos n√£o dependem de ar, √°gua, rochas e solo.", v:false, e:"Dependem das outras esferas."},
  {t:"A dist√¢ncia da Terra ao Sol contribui para temperaturas amenas.", v:true, e:"Condi√ß√£o essencial para a vida."},
  {t:"O azoto √© o g√°s mais abundante na atmosfera.", v:true, e:"Cerca de 78%."},
  {t:"Evapora√ß√£o √© passagem de l√≠quido a gasoso.", v:true, e:"Mudan√ßa de estado."},
  {t:"Condensa√ß√£o √© passagem de gasoso a l√≠quido.", v:true, e:"Mudan√ßa de estado."},
  {t:"Fus√£o √© passagem de l√≠quido a s√≥lido.", v:false, e:"Fus√£o: s√≥lido ‚Üí l√≠quido."},
  {t:"Solidifica√ß√£o √© passagem de l√≠quido a s√≥lido.", v:true, e:"Mudan√ßa de estado."},
  {t:"O efeito de estufa natural ajuda a regular a temperatura da Terra.", v:true, e:"Fun√ß√£o da atmosfera."},
  {t:"A hidrosfera n√£o inclui gelo.", v:false, e:"Inclui gelo (calotes, glaciares)."},
  {t:"√Ågua salobra tem salinidade superior √† √°gua do mar.", v:false, e:"√â interm√©dia entre doce e salgada."},
  {t:"Ambientes de transi√ß√£o incluem estu√°rios e sapais.", v:true, e:"Tal como referido nos documentos."},
  {t:"Fatores do meio incluem luz, temperatura, √°gua/salinidade e tipo de solo/rocha.", v:true, e:"Listados na unidade."}
];

/* =======================================================
   Persist√™ncia e utilit√°rios
   ======================================================= */
const KEY = "EC5_U1_STRICT_progress_v2";
const STATS_KEY = "EC5_U1_STRICT_stats_v2";
const now = () => new Date();
const todayStr = () => new Date().toISOString().slice(0,10);
const addDays = (d,n)=>{const t=new Date(d); t.setDate(t.getDate()+n); return t.toISOString().slice(0,10);};
const clamp=(v,a,b)=>Math.min(b,Math.max(a,v));

function loadProgress(){ try{ return JSON.parse(localStorage.getItem(KEY)||"{}"); }catch(e){ return {}; } }
function saveProgress(p){ localStorage.setItem(KEY, JSON.stringify(p)); }
function loadStats(){ try{ return JSON.parse(localStorage.getItem(STATS_KEY)||JSON.stringify({timeSec:0,streak:0,lastDay:null,quiz:[]})); }catch(e){ return {timeSec:0,streak:0,lastDay:null,quiz:[]}; } }
function saveStats(s){ localStorage.setItem(STATS_KEY, JSON.stringify(s)); }

let PROG = loadProgress();
let STATS = loadStats();

/* =======================================================
   UI (temas, listas, impress√£o)
   ======================================================= */
const temas = ["Todos","A Terra","Hidrosfera","√Åguas","Atmosfera","Geosfera","Biosfera","Ambientes","S√≠ntese"];
const temaSelect = document.getElementById('temaSelect');
const quizTema = document.getElementById('quizTema');
temas.forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; temaSelect.appendChild(o); quizTema.appendChild(o.cloneNode(true)); });

const temaList = document.getElementById('temaList');
function buildTemaList(){
  temaList.innerHTML="";
  const byTema = Object.fromEntries(temas.filter(t=>t!=="Todos").map(t=>[t, CARDS.filter(c=>c.tema===t)]));
  Object.entries(byTema).forEach(([t, cards])=>{
    const dom = cards.filter(c=> (PROG[c.id]?.box||0)>=3).length;
    const vistos = cards.filter(c=> PROG[c.id]).length;
    const pct = cards.length? Math.round(dom/cards.length*100) : 0;
    const div = document.createElement('div'); div.className="item";
    div.innerHTML = `<div><div><strong>${t}</strong> <span class="tag">${cards.length} cart√µes</span></div>
      <div class="progress" style="margin-top:.3rem;width:260px"><div class="bar" style="width:${pct}%"></div></div>
      <div class="small muted">${dom} dominados ‚Ä¢ ${vistos} vistos</div></div>
      <button class="btn" data-gotema="${t}">Estudar</button>`;
    temaList.appendChild(div);
  });
  temaList.querySelectorAll('button[data-gotema]').forEach(b=> b.onclick=()=>{ temaSelect.value=b.dataset.gotema; pickNextCard(); switchTab('flash'); });
}
buildTemaList();

function buildPrintAll(){
  const box = document.getElementById('printAll');
  box.innerHTML = CARDS.map(c=> `<details><summary><strong>${c.tema}</strong> ‚Äî ${c.q}</summary><div class="small">${c.a}</div></details>`).join("");
}
buildPrintAll();

/* =======================================================
   Cart√µes: l√≥gica (Leitner 1/3/7 dias)
   ======================================================= */
const dueCountEl=document.getElementById('dueCount');
const masteryPctEl=document.getElementById('masteryPct');
const globalBar=document.getElementById('globalBar');
const sessStatsEl=document.getElementById('sessStats');
let sessRight=0, sessTotal=0;
let sessionStart=Date.now();
const timerEl=document.getElementById('timer');
function tickTimer(){ const sec=Math.floor((Date.now()-sessionStart)/1000); timerEl.textContent=new Date(sec*1000).toISOString().slice(14,19); }
setInterval(tickTimer,1000);

function cardState(id){ return PROG[id] || {box:0, seen:0, right:0, wrong:0, next:todayStr(), last:null}; }
function schedule(id, correct){
  const s = cardState(id); s.seen++; s.last=todayStr();
  if(correct){ s.right++; s.box=clamp(s.box+1,1,3); } else { s.wrong++; s.box=1; }
  const interval = s.box===1?1:(s.box===2?3:7);
  s.next = correct? addDays(todayStr(), interval) : todayStr();
  PROG[id]=s; saveProgress(PROG);
  sessTotal++; if(correct) sessRight++;
  updateDashboard();
  // streak: conta dia em que faz ‚â•10 cart√µes
  const day=todayStr();
  if(sessTotal>=10){
    if(STATS.lastDay!==day){ STATS.streak=(STATS.lastDay===addDays(day,-1))? (STATS.streak||0)+1 : 1; STATS.lastDay=day; saveStats(STATS); }
  }
}
function dueCards(filterTema){
  const day=todayStr();
  return CARDS.filter(c=>{
    const s=cardState(c.id);
    const temaOK=(filterTema==="Todos" || c.tema===filterTema);
    return temaOK && (!s.seen || s.next<=day);
  });
}
function updateDashboard(){
  const total=CARDS.length;
  const dom=CARDS.filter(c=> (cardState(c.id).box)>=3).length;
  const vistos=CARDS.filter(c=> cardState(c.id).seen>0).length;
  const dueToday=dueCards(temaSelect.value).length;
  const pct=Math.round(dom/total*100);
  masteryPctEl.textContent=pct+"%"; globalBar.style.width=pct+"%"; dueCountEl.textContent=dueToday; sessStatsEl.textContent=`${sessRight}/${sessTotal}`;
  document.getElementById('pTotal').textContent=total;
  document.getElementById('pVistos').textContent=vistos;
  document.getElementById('pDom').textContent=dom;
  document.getElementById('pDueToday').textContent=dueCards("Todos").length;
  const elapsed=Math.floor((Date.now()-sessionStart)/1000); const prev=STATS.timeSec||0;
  document.getElementById('pTime').textContent=Math.floor((prev+elapsed)/60)+" min";
  document.getElementById('pStreak').textContent=(STATS.streak||0)+" üî•";
  // calend√°rio de revis√µes
  const cal=document.getElementById('calendar');
  const counts={};
  CARDS.forEach(c=>{ const s=cardState(c.id); counts[s.next]=(counts[s.next]||0)+1; });
  cal.innerHTML="";
  for(let i=0;i<14;i++){
    const d=addDays(todayStr(),i); const n=counts[d]||0; const barw=clamp(n*4,0,100);
    const div=document.createElement('div'); div.className="item";
    div.innerHTML=`<span>${d}</span><div class="progress" style="width:200px"><div class="bar" style="width:${barw}%"></div></div><strong>${n}</strong>`;
    cal.appendChild(div);
  }
}
updateDashboard();

const fcQ=document.getElementById('fcQ');
const fcA=document.getElementById('fcA');
const fcMeta=document.getElementById('fcMeta');
let currentCard=null;
function renderCard(c){
  currentCard=c; fcQ.textContent=c.q; fcA.textContent=c.a; fcA.classList.add('hidden');
  document.getElementById('revealBtn').disabled=false;
  document.getElementById('rightBtn').disabled=true;
  document.getElementById('wrongBtn').disabled=true;
  const s=cardState(c.id);
  fcMeta.innerHTML=`<span class="tag">${c.tema}</span> <span class="tag">Caixa ${Math.max(1,s.box||1)}</span> <span class="tag">Vistos: ${s.seen||0}</span>`;
}
function pickNextCard(){
  const filterTema=temaSelect.value;
  const pool=dueCards(filterTema);
  if(pool.length>0){ renderCard(pool[Math.floor(Math.random()*pool.length)]); return; }
  const alt=CARDS.filter(c=> (filterTema==="Todos" || c.tema===filterTema))
                 .sort((a,b)=> (cardState(a.id).box||0)-(cardState(b.id).box||0));
  renderCard(alt[0]);
}

document.getElementById('revealBtn').onclick=()=>{ fcA.classList.remove('hidden'); document.getElementById('rightBtn').disabled=false; document.getElementById('wrongBtn').disabled=false; document.getElementById('revealBtn').disabled=true; };
document.getElementById('rightBtn').onclick=()=>{ if(!currentCard) return; schedule(currentCard.id,true); pickNextCard(); };
document.getElementById('wrongBtn').onclick=()=>{ if(!currentCard) return; schedule(currentCard.id,false); pickNextCard(); };
document.getElementById('nextBtn').onclick=pickNextCard;
temaSelect.onchange=()=>{ updateDashboard(); pickNextCard(); };

// --- Atalhos de teclado globais ---
window.addEventListener('keydown', (e) => {
  if (currentTab === "flash") {
    if (e.code === "Space") { e.preventDefault(); document.getElementById('revealBtn').click(); }
    if (e.key.toLowerCase() === 'a') { document.getElementById('rightBtn').click(); }
    if (e.key.toLowerCase() === 'e') { document.getElementById('wrongBtn').click(); }
  } else if (currentTab === "vf") {
    const key = e.key.toLowerCase();
    if (key === "v") { document.getElementById("vfV").click(); }
    else if (key === "f") { document.getElementById("vfF").click(); }
    else if (e.code === "Space") { e.preventDefault(); document.getElementById("vfNew").click(); }
  }
});

/* Exportar / importar / repor */
document.getElementById('exportBtn').onclick=()=>{
  const payload={progress:PROG, stats:STATS, exportedAt:new Date().toISOString()};
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download="progresso_ciencias_u1_estrita_v2.json"; a.click(); URL.revokeObjectURL(url);
};
document.getElementById('importFile').onchange=(ev)=>{
  const file=ev.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    try{
      const data=JSON.parse(reader.result);
      if(data.progress){ PROG=data.progress; saveProgress(PROG); }
      if(data.stats){ STATS=data.stats; saveStats(STATS); }
      alert("Importa√ß√£o conclu√≠da!");
      updateDashboard(); buildTemaList(); pickNextCard();
    }catch(e){ alert("Ficheiro inv√°lido."); }
  };
  reader.readAsText(file);
};
document.getElementById('resetBtn').onclick=()=>{
  if(confirm("Apagar TODO o progresso?")){ localStorage.removeItem(KEY); localStorage.removeItem(STATS_KEY);
    PROG={}; STATS={timeSec:0,streak:0,lastDay:null,quiz:[]}; updateDashboard(); buildTemaList(); alert("Progresso reposto."); }
};

/* =======================================================
   Teste R√°pido ‚Äî distratores plaus√≠veis e n√≠veis
   ======================================================= */
const quizBox=document.getElementById('quizBox');
const startQuizBtn=document.getElementById('startQuiz');
const quizScoreEl=document.getElementById('quizScore');
const quizHistory=document.getElementById('quizHistory');
const quizLvlSel=document.getElementById('quizLvl');

function normalizeEnd(s){
  s = s.trim();
  if(/[.;]$/.test(s)) return s;
  return s + ".";
}
function similarLengthFilter(cands, targetLen, tol=0.35){
  return cands.filter(t=> Math.abs(t.length - targetLen)/Math.max(1,targetLen) <= tol);
}
function unique(arr){ return Array.from(new Set(arr)); }

function handcraftedDistractors(card){
  const list = DIST[card.id] || [];
  return list.map(normalizeEnd);
}

function sample(arr, k){
  const a=arr.slice(); const out=[];
  while(a.length && out.length<k){
    const i=Math.floor(Math.random()*a.length);
    out.push(a.splice(i,1)[0]);
  }
  return out;
}

function smartThemeDistractors(correctCard, tema, targetLen){
  // Fallback: respostas de cart√µes do mesmo tema (ou globais) com tamanho semelhante e sem coincid√™ncia literal
  const pool = CARDS.filter(c=> c.id!==correctCard.id && (!tema || c.tema===tema));
  let texts = pool.map(c=> c.a).filter(x=> x && x.length>2 && x!==correctCard.a);
  texts = texts.map(normalizeEnd);
  let out = similarLengthFilter(texts, targetLen, 0.35);
  if(out.length<6) out = texts; // se curto, relaxa
  return unique(out);
}

function buildDistractors(card, tema, level){
  const targetLen = card.a.length;
  let ds = [];
  // 1) Feitos √† m√£o
  ds = handcraftedDistractors(card);
  // 2) Adapta√ß√£o ao n√≠vel
  if(level==="facil"){
    // completa com outros do tema, sem filtro apertado
    if(ds.length<3){
      const extras = smartThemeDistractors(card, (tema==="Todos"?null:tema), targetLen);
      ds = unique(ds.concat(extras));
    }
  } else if(level==="medio"){
    // usa os feitos √† m√£o; se faltar, junta op√ß√µes de tamanho semelhante
    if(ds.length<3){
      const extras = smartThemeDistractors(card, (tema==="Todos"?null:tema), targetLen);
      const near = similarLengthFilter(extras, targetLen, 0.25);
      ds = unique(ds.concat(near));
    }
  } else { // dif√≠cil
    // prioriza feitos √† m√£o + op√ß√µes muito pr√≥ximas em comprimento
    const extras = smartThemeDistractors(card, (tema==="Todos"?null:tema), targetLen);
    const near = similarLengthFilter(extras, targetLen, 0.18);
    ds = unique(ds.concat(near));
  }
  // limpa iguais ao correto e garante variedade
  ds = ds.filter(x=> x !== card.a);
  // se ainda faltar, completa com qualquer outro texto plaus√≠vel
  if(ds.length<3){
    const extras = smartThemeDistractors(card, null, targetLen);
    ds = unique(ds.concat(extras)).filter(x=> x!==card.a);
  }
  // corta a 3 finais
  return sample(ds, 3);
}

function renderQuizHistory(){
  quizHistory.innerHTML="";
  (STATS.quiz||[]).forEach(r=>{
    const d=new Date(r.date).toLocaleString();
    const row=document.createElement('div'); row.className="item";
    row.innerHTML=`<span>${d} ‚Ä¢ <span class="muted">${r.tema}</span></span> <strong>${r.score}/${r.n} (${r.acc}%)</strong>`;
    quizHistory.appendChild(row);
  });
}
renderQuizHistory();

function buildQuiz(n, tema, level){
  const pool=CARDS.filter(c=> tema==="Todos"? true : c.tema===tema);
  const chosen=[]; const used=new Set();
  while(chosen.length<n && used.size<pool.length){
    const i=Math.floor(Math.random()*pool.length); if(used.has(i)) continue; used.add(i); chosen.push(pool[i]);
  }
  let score=0, index=0; quizBox.innerHTML="";
  function renderQ(){
    const c=chosen[index];
    const ds=buildDistractors(c, tema, level);
    const opts=[...ds, normalizeEnd(c.a)].sort(()=>Math.random()-0.5);

    const div=document.createElement('div');
    div.className="panel"; div.style.marginBottom=".8rem";
    div.innerHTML=`<div class="small muted"><span class="tag">${c.tema}</span> Pergunta ${index+1} de ${chosen.length}</div>
                   <div style="font-size:1.05rem;margin:.4rem 0 .6rem">${c.q}</div>`;

    const exp = document.createElement('div');
    exp.className = "small muted";
    exp.style.marginTop = ".4rem";

    opts.forEach((txt)=>{
      const b=document.createElement('button');
      b.className="btn";
      b.style.display="block"; b.style.width="100%"; b.style.textAlign="left"; b.style.marginBottom=".4rem";
      b.textContent=txt;
      b.onclick=()=>{
        Array.from(div.querySelectorAll('button')).forEach(x=>x.disabled=true);
        const correct = (txt===normalizeEnd(c.a));
        if(correct){ b.classList.add('good'); score++; exp.innerHTML = "‚úÖ Correto ‚Äî " + normalizeEnd(c.a); }
        else{ b.classList.add('bad'); exp.innerHTML = "‚ùå Incorrecto ‚Äî Resposta certa: " + normalizeEnd(c.a); }
        quizScoreEl.textContent=score;
        div.appendChild(exp);

        if(index<chosen.length-1){
          // pequena pausa para ler a explica√ß√£o
          setTimeout(()=>{ index++; renderQ(); }, 600);
        } else {
          const acc=Math.round(score/chosen.length*100);
          const res=document.createElement('div'); res.className="item"; res.innerHTML=`<span>Resultado final</span> <strong>${score}/${chosen.length} (${acc}%)</strong>`;
          quizBox.appendChild(res);
          STATS.quiz=STATS.quiz||[]; STATS.quiz.unshift({date:new Date().toISOString(), tema, n:chosen.length, score, acc}); STATS.quiz=STATS.quiz.slice(0,10); saveStats(STATS); renderQuizHistory();
        }
      };
      div.appendChild(b);
    });
    quizBox.appendChild(div);
  }
  renderQ();
}

startQuizBtn.onclick=()=>{
  const n=clamp(parseInt(document.getElementById('quizN').value||"10",10),5,25);
  const tema=document.getElementById('quizTema').value;
  const level = quizLvlSel.value;
  quizScoreEl.textContent="0";
  buildQuiz(n, tema, level);
};

/* =======================================================
   Verdadeiro/Falso (igual)
   ======================================================= */
let vfSess=0; const vfSessEl=document.getElementById('vfSess');
function newVF(){
  const i=Math.floor(Math.random()*VF.length); const v=VF[i];
  document.getElementById('vfText').textContent=v.t; document.getElementById('vfText').dataset.idx=i;
  document.getElementById('vfExp').classList.add('hidden'); document.getElementById('vfMeta').textContent="Marque a op√ß√£o correta e veja a explica√ß√£o.";
}
document.getElementById('vfNew').onclick=newVF;
function answerVF(ans){
  const idx=+document.getElementById('vfText').dataset.idx; if(isNaN(idx)) return; const v=VF[idx];
  const ok=(ans===v.v); const exp=document.getElementById('vfExp');
  exp.textContent=(ok?"‚úÖ Correto. ":"‚ùå Incorrecto. ")+(v.e||""); exp.classList.remove('hidden'); if(ok){ vfSess++; vfSessEl.textContent=vfSess; }
}
document.getElementById('vfV').onclick=()=>answerVF(true);
document.getElementById('vfF').onclick=()=>answerVF(false);

/* =======================================================
   Tabs + init
   ======================================================= */
let currentTab="flash";
function switchTab(id){
  document.querySelectorAll('.tab').forEach(el=>el.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.querySelectorAll('.tabbtn').forEach(b=> b.classList.toggle('active', b.dataset.tab===id));
  currentTab=id;
  if(id==="flash"){ pickNextCard(); }
  if(id==="painel"){ updateDashboard(); }
}
document.querySelectorAll('.tabbtn').forEach(b=> b.onclick=()=> switchTab(b.dataset.tab));
switchTab("flash");

/* Guardar tempo ao sair */
window.addEventListener('beforeunload', ()=>{
  const elapsed=Math.floor((Date.now()-sessionStart)/1000);
  STATS.timeSec=(STATS.timeSec||0)+elapsed; saveStats(STATS);
});
</script>
</body>
</html>
